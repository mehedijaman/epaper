import{d as Zn,x as p,I as qt,z as K,B as it,A as el,Q as tl,o as f,c as _,e as o,f as l,h as nl,w as s,a as i,j as G,K as d,J as r,k as C,F as le,L as _e,O as ae,n as w,G as E,l as Kt,p as c,M as Be}from"./app-BIDwooZD.js";import{_ as st}from"./ConfirmActionDialog.vue_vue_type_script_setup_true_lang-C7nxwQ1e.js";import{_ as ll,P as al,T as ol}from"./EditionContextBar.vue_vue_type_script_setup_true_lang-BA6c6IMC.js";import{_ as je}from"./InputError.vue_vue_type_script_setup_true_lang-Dl_-9lDx.js";import{_ as J}from"./index-Y7wIGGvX.js";import{_ as g}from"./index-C8P2q1AW.js";import{_ as Gt,a as il,b as sl,c as Jt}from"./CardTitle.vue_vue_type_script_setup_true_lang-ChP2b989.js";import{_ as ul,a as rl,b as dl,c as cl,d as vl}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DvCkWFlb.js";import{_ as fl}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Cg5QyE-8.js";import{_ as Qt}from"./Input.vue_vue_type_script_setup_true_lang-B1SXL9YZ.js";import{_ as Ce,a as Se,b as $e,c as Me,d as A}from"./SelectValue.vue_vue_type_script_setup_true_lang-CtmDDGDY.js";import{_ as pl}from"./EpAdminLayout.vue_vue_type_script_setup_true_lang-C7XcxSU8.js";import{c as Zt}from"./createLucideIcon-ccUrNrU9.js";import"./Primitive-BLKkOots.js";import"./useForwardPropsEmits-ljZNR3_O.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-DSMqO86V.js";import"./chevron-right-CAogZLbH.js";import"./VisuallyHidden-Cp8joezf.js";import"./RovingFocusGroup-CSddD9ru.js";import"./newspaper-BTZbB5ry.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-rq6uf0wM.js";import"./check-BMDuJIhl.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./useFormControl-DzJJrvcL.js";import"./index-CR_w27Kk.js";import"./AlertTitle.vue_vue_type_script_setup_true_lang-C9ceEc2p.js";const gl=Zt("LinkIcon",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const ml=Zt("SaveIcon",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),_l={class:"space-y-4 p-4"},bl={class:"flex flex-wrap items-start justify-between gap-3"},hl={class:"space-y-1"},xl={class:"grid gap-3 lg:grid-cols-[minmax(0,1.4fr)_repeat(3,minmax(0,1fr))]"},wl={class:"space-y-3 rounded-lg border bg-background p-3"},yl={class:"flex items-center justify-between gap-2"},kl={class:"text-xs font-medium text-muted-foreground"},Dl={class:"grid grid-cols-2 gap-2"},Cl={class:"space-y-1 rounded-lg border bg-background p-3"},Sl={class:"text-2xl font-semibold"},$l={class:"text-xs text-muted-foreground"},Ml={class:"space-y-1 rounded-lg border bg-background p-3"},Tl={class:"text-2xl font-semibold"},Hl={class:"text-xs text-muted-foreground"},zl={class:"space-y-1 rounded-lg border bg-background p-3"},Il={class:"text-2xl font-semibold"},Ll={class:"text-xs text-muted-foreground"},Nl={class:"mt-2 flex flex-wrap gap-2"},El={class:"grid items-stretch gap-4 xl:grid-cols-[minmax(0,1fr)_24rem]"},Pl={class:"space-y-3"},Vl={class:"flex flex-wrap items-center justify-between gap-2 rounded-lg border bg-background px-3 py-2 text-xs"},Rl={class:"flex flex-wrap items-center gap-2"},Fl={class:"flex items-center gap-2"},Al={key:0,class:"flex flex-wrap items-center justify-between gap-2 rounded-lg border border-blue-300 bg-blue-50 px-3 py-2 text-xs text-blue-900"},Ol={class:"space-y-1"},Ul={class:"relative w-full"},Bl=["src","alt"],jl=["title","onMouseenter","onMouseleave","onMousedown","onTouchstart"],Wl={key:0,class:"pointer-events-none absolute -top-2 left-0 rounded bg-slate-900/85 px-1 py-0.5 text-[10px] leading-none font-semibold tracking-wide text-white uppercase"},Xl={class:"px-1 text-[10px] font-semibold text-muted-foreground"},Yl=["onMousedown","onTouchstart"],ql={key:2,class:"pointer-events-none absolute top-2 right-2 rounded bg-slate-900/80 px-2 py-1 text-[11px] font-medium text-white"},Kl={class:"flex h-full min-h-0 min-h-[24rem] flex-col overflow-hidden rounded-xl border bg-background"},Gl={class:"flex flex-wrap items-center justify-between gap-2 border-b px-4 py-3"},Jl={class:"text-xs text-muted-foreground"},Ql={class:"flex flex-col gap-3 border-b p-3"},Zl={class:"space-y-2"},ea={class:"flex flex-wrap gap-2"},ta={class:"flex flex-wrap gap-2"},na={class:"space-y-2 rounded-lg border bg-muted/20 p-2"},la={class:"flex flex-wrap items-center justify-between gap-2 text-xs text-muted-foreground"},aa={class:"flex flex-wrap gap-2"},oa={class:"flex-1 space-y-3 overflow-y-auto p-3"},ia=["onMouseenter","onMouseleave","onFocus","onBlur","onClick","onKeydown"],sa={class:"flex items-start gap-3"},ua=["checked","onChange"],ra={class:"sr-only"},da={class:"relative h-16 w-24 shrink-0 overflow-hidden rounded-md border bg-muted/30"},ca=["src"],va={key:1,class:"flex h-full w-full items-center justify-center text-[10px] text-muted-foreground"},fa={class:"min-w-0 flex-1 space-y-2 text-sm"},pa={class:"flex flex-wrap items-center justify-between gap-2"},ga={class:"font-medium"},ma={class:"text-muted-foreground"},_a={key:0,class:"text-muted-foreground"},ba={key:0},ha={key:1,class:"truncate text-muted-foreground"},xa={key:0,class:"text-sm text-muted-foreground"},wa={key:1,class:"text-sm text-muted-foreground"},ya={key:0,class:"text-xs text-amber-700"},ka={class:"space-y-4"},Da={class:"space-y-3 rounded-lg border bg-muted/20 p-3"},Ca={class:"grid gap-3 md:grid-cols-2"},Sa={class:"space-y-2"},$a={class:"space-y-2"},Ma={class:"space-y-2"},Ta={key:0},Ha={class:"text-muted-foreground"},za={class:"space-y-3 rounded-lg border p-3"},Ia={class:"space-y-2"},La={key:0,class:"flex flex-wrap items-center justify-between gap-2 rounded-md border bg-muted/20 p-2"},io=Zn({__name:"Map",props:{selected_page_id:{},edition:{},page:{},edition_pages:{},target_page_numbers:{},target_hotspots_by_page:{},focus_hotspot_id:{}},setup(en){const v=en,tn=[{title:"Page Mapping",href:"/admin/hotspots"}],ut=p(null),We=p(null),k=p({width:0,height:0}),Te=p({width:0,height:0}),oe=p(v.selected_page_id!==null?String(v.selected_page_id):""),H=p(!1),I=p(null),D=p(null),Q=p(!1),$=p(null),Xe=p(v.focus_hotspot_id),te=p(""),S=p(null),z=p(!0),P=p("all"),ne=p("id_asc"),Ye=new Map,b=p(null),ie=p(!1),V=p(null),L=p([]),se=p(!1),j=p("manual"),ue=p(!1),He=p(null),re=p(null),M=p(null),be=p(null),he=p(null),W=p(null),h=p(null),xe=p(null),u=qt({page_id:0,relation_kind:"next",target_page_no:null,target_hotspot_id:null,x:0,y:0,w:0,h:0,label:""}),de=qt({page_id:0,hotspot_ids:[]}),y=c(()=>v.page),x=c(()=>y.value?.hotspots??[]),qe=c(()=>y.value!==null),nn=["nw","n","ne","e","se","s","sw","w"],ln=c(()=>v.target_page_numbers.length>0?v.target_page_numbers:y.value!==null?[y.value.page_no]:[]),Ke=c(()=>{const e=new Map;for(const[t,n]of Object.entries(v.target_hotspots_by_page)){const a=Number.parseInt(t,10);Number.isFinite(a)&&e.set(a,n.map(m=>({id:m.id,relation_kind:m.relation_kind,target_page_no:m.target_page_no,label:m.label})))}return e}),rt=c(()=>{if(u.target_page_no===null)return[];const e=Ke.value.get(u.target_page_no)??[];return $.value===null?e:e.filter(t=>t.id!==$.value)}),dt=c({get:()=>u.target_page_no===null?"__none":String(u.target_page_no),set:e=>{if(e==="__none"){u.target_page_no=null;return}const t=Number.parseInt(e,10);u.target_page_no=Number.isFinite(t)?t:null}}),ct=c({get:()=>u.target_hotspot_id===null?"__none":String(u.target_hotspot_id),set:e=>{if(e==="__none"){u.target_hotspot_id=null;return}const t=Number.parseInt(e,10);u.target_hotspot_id=Number.isFinite(t)?t:null}}),vt=c(()=>({width:`${k.value.width}px`,height:`${k.value.height}px`})),ze=c(()=>{if(y.value===null)return"";const e=y.value.image_large_url;return typeof e=="string"&&e.trim()!==""?e:y.value.image_original_url}),an=c(()=>$.value===null?"Create hotspot":"Edit hotspot"),on=c(()=>$.value===null?"Save hotspot":"Update hotspot"),sn=c(()=>D.value!==null),ft=c(()=>{const e=[...x.value];return ne.value==="id_desc"?e.sort((t,n)=>n.id-t.id):ne.value==="target_page"?e.sort((t,n)=>{if(t.target_page_no===n.target_page_no)return t.id-n.id;const a=t.target_page_no??Number.MAX_SAFE_INTEGER,m=n.target_page_no??Number.MAX_SAFE_INTEGER;return a-m}):ne.value==="relation"?e.sort((t,n)=>t.relation_kind===n.relation_kind?t.id-n.id:t.relation_kind.localeCompare(n.relation_kind)):e.sort((t,n)=>t.id-n.id)}),pt=c(()=>P.value==="all"?ft.value:ft.value.filter(e=>F(e)===P.value)),X=c(()=>{const e=te.value.trim().toLowerCase();return e===""?pt.value:pt.value.filter(t=>{const n=t.label?.toLowerCase()??"",a=ye(t);return String(t.id).includes(e)||t.relation_kind.toLowerCase().includes(e)||String(t.target_page_no??"none").includes(e)||a!==null&&String(a).includes(e)||n.includes(e)||Oe(F(t)).toLowerCase().includes(e)})}),Ie=c(()=>new Set(L.value)),we=c(()=>L.value.length),gt=c(()=>X.value.reduce((e,t)=>Ie.value.has(t.id)?e+1:e,0)),Le=c(()=>we.value>0),mt=c(()=>X.value.length>0&&gt.value===X.value.length),Ne=c(()=>!Q.value||He.value===null?!1:He.value!==Mt()),un=c(()=>Ne.value||D.value!==null||h.value!==null),Ee=c(()=>x.value.filter(e=>F(e)==="mismatch").map(e=>e.id)),Pe=c(()=>x.value.filter(e=>F(e)==="none").map(e=>e.id)),rn=c(()=>j.value==="mismatch"?"Delete mismatch hotspots?":j.value==="unlinked"?"Delete unlinked hotspots?":"Delete selected hotspots?"),dn=c(()=>j.value==="mismatch"?"Delete mismatches":j.value==="unlinked"?"Delete unlinked":"Delete selected"),cn=c(()=>j.value==="mismatch"?`Delete ${we.value} mismatch hotspot(s)? Linked references will be detached where needed. This action cannot be undone.`:j.value==="unlinked"?`Delete ${we.value} unlinked hotspot(s)? This action cannot be undone.`:`Delete ${we.value} selected hotspot(s)? Linked references will be detached where needed. This action cannot be undone.`),R=c(()=>{const e={paired:0,outbound:0,inbound:0,mismatch:0,none:0};for(const t of x.value){const n=F(t);e[n]+=1}return e}),Ve=c(()=>v.edition_pages.findIndex(e=>String(e.id)===oe.value)),_t=c(()=>Ve.value>0),bt=c(()=>Ve.value>=0&&Ve.value<v.edition_pages.length-1),vn=c(()=>v.edition!==null&&typeof v.edition.name=="string"&&v.edition.name.trim()!==""?v.edition.name.trim():v.edition!==null?`Edition ${v.edition.id}`:"Edition"),fn=c(()=>{if(v.edition!==null)return`/admin/editions/manage?date=${v.edition.edition_date}&edition_id=${v.edition.id}`}),pn=c(()=>{if(v.edition!==null)return`/admin/editions/publish?date=${v.edition.edition_date}&edition_id=${v.edition.id}`}),gn=c(()=>oe.value===""?"/admin/hotspots":`/admin/hotspots?page_id=${oe.value}`),mn=c(()=>te.value.trim()!==""||P.value!=="all"||ne.value!=="id_asc"),O=c(()=>b.value===null?null:x.value.find(e=>e.id===b.value)??null),Ge=c(()=>O.value===null?null:M.value!==null&&W.value!==null?W.value:h.value!==null?h.value:{x:O.value.x,y:O.value.y,w:O.value.w,h:O.value.h});K(()=>v.selected_page_id,e=>{oe.value=e!==null?String(e):"",D.value=null,h.value=null,W.value=null,H.value=!1,I.value=null,b.value=null,Y(),L.value=[],se.value=!1,ue.value=!1,re.value=null,it(()=>{window.requestAnimationFrame(ce)})}),K(()=>ze.value,()=>{it(()=>{window.requestAnimationFrame(ce)})}),K(()=>v.focus_hotspot_id,e=>{Xe.value=e,zt()},{immediate:!0}),K(()=>u.target_page_no,()=>{if(u.target_hotspot_id===null)return;rt.value.some(t=>t.id===u.target_hotspot_id)||(u.target_hotspot_id=null)}),K(x,()=>{zt();const e=new Set(x.value.map(n=>n.id)),t=L.value.filter(n=>e.has(n));t.length!==L.value.length&&(L.value=t),t.length===0&&(se.value=!1),b.value!==null&&!x.value.some(n=>n.id===b.value)&&(b.value=null,Y(),D.value=null,h.value=null,W.value=null)}),K($,e=>{S.value=e}),K(S,async e=>{e!==null&&(await it(),Ye.get(e)?.scrollIntoView({behavior:"smooth",block:"nearest"}))}),el(()=>{window.addEventListener("resize",ce),window.addEventListener("keydown",Xt),window.addEventListener("mousemove",xt),window.addEventListener("mouseup",wt),window.addEventListener("beforeunload",Yt),ce()}),tl(()=>{window.removeEventListener("resize",ce),window.removeEventListener("keydown",Xt),window.removeEventListener("mousemove",xt),window.removeEventListener("mouseup",wt),window.removeEventListener("beforeunload",Yt)});function N(e,t=0,n=1){return Math.min(Math.max(e,t),n)}function ce(){const e=We.value;if(e===null){k.value={width:0,height:0},Te.value={width:0,height:0};return}const t=e.getBoundingClientRect();k.value={width:Math.max(0,t.width),height:Math.max(0,t.height)},Te.value={width:Math.max(0,e.naturalWidth),height:Math.max(0,e.naturalHeight)}}function Re(e,t){const n=We.value;if(n===null)return null;const a=n.getBoundingClientRect();return a.width<=0||a.height<=0?null:{x:N((e-a.left)/a.width),y:N((t-a.top)/a.height)}}function ht(e,t){if(!qe.value||!z.value)return;const n=Re(e,t);n!==null&&(H.value=!0,I.value=n,D.value={x:n.x,y:n.y,w:0,h:0})}function Je(e,t){if(!H.value||I.value===null)return;const n=Re(e,t);if(n===null)return;const a=Math.min(I.value.x,n.x),m=Math.min(I.value.y,n.y),T=Math.abs(n.x-I.value.x),U=Math.abs(n.y-I.value.y);D.value={x:N(a),y:N(m),w:N(T),h:N(U)}}function Qe(){if(!H.value||(H.value=!1,I.value=null,D.value===null))return;if(D.value.w<=.005||D.value.h<=.005){D.value=null;return}const e=D.value;if(b.value!==null){const t=x.value.find(n=>n.id===b.value);b.value=null,t!==void 0&&(Z(t),u.x=e.x,u.y=e.y,u.w=e.w,u.h=e.h),D.value=null;return}Ln(e),D.value=null}function Fe(e){const t=e.touches[0]??e.changedTouches[0];return t===void 0?null:{x:t.clientX,y:t.clientY}}function _n(e){e.button===0&&(e.preventDefault(),ht(e.clientX,e.clientY))}function bn(e){if(M.value!==null){e.preventDefault(),et(e.clientX,e.clientY);return}H.value&&(e.preventDefault(),Je(e.clientX,e.clientY))}function hn(e){if(M.value!==null&&e.button===0){e.preventDefault(),tt();return}H.value&&(e.preventDefault(),Qe())}function xt(e){if(M.value!==null){et(e.clientX,e.clientY);return}H.value&&Je(e.clientX,e.clientY)}function wt(e){if(M.value!==null&&e.button===0){tt();return}!H.value||e.button!==0||Qe()}function xn(e){const t=Fe(e);t!==null&&ht(t.x,t.y)}function wn(e){const t=Fe(e);if(t!==null){if(M.value!==null){et(t.x,t.y);return}Je(t.x,t.y)}}function yt(){if(M.value!==null){tt();return}Qe()}function Ze(e){return{left:`${e.x*k.value.width}px`,top:`${e.y*k.value.height}px`,width:`${e.w*k.value.width}px`,height:`${e.h*k.value.height}px`}}function Y(){M.value=null,be.value=null,he.value=null,W.value=null}function yn(e){return e==="n"||e==="s"?"cursor-ns-resize":e==="e"||e==="w"?"cursor-ew-resize":e==="nw"||e==="se"?"cursor-nwse-resize":"cursor-nesw-resize"}function kn(e){return e==="n"?{top:"-6px",left:"50%",transform:"translate(-50%, -50%)"}:e==="s"?{bottom:"-6px",left:"50%",transform:"translate(-50%, 50%)"}:e==="e"?{top:"50%",right:"-6px",transform:"translate(50%, -50%)"}:e==="w"?{top:"50%",left:"-6px",transform:"translate(-50%, -50%)"}:e==="nw"?{top:"-6px",left:"-6px",transform:"translate(-50%, -50%)"}:e==="ne"?{top:"-6px",right:"-6px",transform:"translate(50%, -50%)"}:e==="sw"?{bottom:"-6px",left:"-6px",transform:"translate(-50%, 50%)"}:{bottom:"-6px",right:"-6px",transform:"translate(50%, 50%)"}}function Ae(e,t,n){const a=Ge.value;if(a===null)return;const m=Re(t,n);m!==null&&(M.value=e,be.value=m,he.value={x:a.x,y:a.y,w:a.w,h:a.h},W.value={x:a.x,y:a.y,w:a.w,h:a.h})}function kt(e,t){t.button===0&&(t.preventDefault(),Ae(e,t.clientX,t.clientY))}function Dt(e,t){const n=Fe(t);n!==null&&(t.preventDefault(),Ae(e,n.x,n.y))}function Dn(e,t){t.button===0&&(t.preventDefault(),z.value||(z.value=!0),b.value!==e.id&&ke(e),Ae("move",t.clientX,t.clientY))}function Cn(e,t){const n=Fe(t);n!==null&&(t.preventDefault(),z.value||(z.value=!0),b.value!==e.id&&ke(e),Ae("move",n.x,n.y))}function et(e,t){if(M.value===null||be.value===null||he.value===null)return;const n=Re(e,t);if(n===null)return;const a=he.value,m=M.value,T=n.x-be.value.x,U=n.y-be.value.y,q=.005;if(m==="move"){const at=N(a.x+T,0,Math.max(0,1-a.w)),ot=N(a.y+U,0,Math.max(0,1-a.h));W.value={x:at,y:ot,w:a.w,h:a.h};return}let ee=a.x,B=a.y,ge=a.x+a.w,me=a.y+a.h;m.includes("w")&&(ee=N(ee+T,0,ge-q)),m.includes("e")&&(ge=N(ge+T,ee+q,1)),m.includes("n")&&(B=N(B+U,0,me-q)),m.includes("s")&&(me=N(me+U,B+q,1)),W.value={x:ee,y:B,w:ge-ee,h:me-B}}function tt(){if(M.value===null)return;const e=he.value,t=W.value;Y(),!(e===null||t===null||!(Math.abs(t.x-e.x)>1e-6||Math.abs(t.y-e.y)>1e-6||Math.abs(t.w-e.w)>1e-6||Math.abs(t.h-e.h)>1e-6))&&(h.value={x:t.x,y:t.y,w:t.w,h:t.h})}function Sn(e){const t=Te.value.width,n=Te.value.height;if(t<=0||n<=0)return{};const a=96,m=64,T=Math.max(e.w,1e-6),U=Math.max(e.h,1e-6),q=T*t,ee=U*n;if(q<=0||ee<=0)return{};const B=Math.min(a/q,m/ee),ge=t*B,me=n*B,at=(e.x+T/2)*t*B,ot=(e.y+U/2)*n*B,Jn=a/2-at,Qn=m/2-ot;return{width:`${ge}px`,height:`${me}px`,left:`${Jn}px`,top:`${Qn}px`,maxWidth:"none"}}function $n(e){for(const[t,n]of Ke.value.entries())if(n.some(m=>m.id===e))return t;return null}function ye(e){return e.target_hotspot_id??e.linked_hotspot_id??null}function Ct(e){for(const[t,n]of Ke.value.entries()){if(!n.some(T=>T.id===e))continue;const m=v.edition_pages.find(T=>T.page_no===t);if(m!==void 0)return{pageNo:t,pageId:m.id}}return null}function St(e){const t=ye(e);return t===null?null:Ct(t)?.pageNo??null}function F(e){const t=e.target_hotspot_id??null,n=e.linked_hotspot_id??null;return t===null&&n===null?"none":t!==null&&n!==null?t===n?"paired":"mismatch":t!==null?"outbound":"inbound"}function Oe(e){return e==="paired"?"Linked":e==="outbound"?"Outbound link":e==="inbound"?"Inbound link":e==="mismatch"?"Link mismatch":"No link"}function Mn(e){return e==="paired"?"default":e==="outbound"||e==="inbound"?"secondary":e==="mismatch"?"destructive":"outline"}function Tn(e){const t=F(e);return t==="paired"?"border-emerald-500 bg-emerald-500/15 hover:bg-emerald-500/25":t==="outbound"?"border-sky-500 bg-sky-500/15 hover:bg-sky-500/25":t==="inbound"?"border-amber-500 bg-amber-500/15 hover:bg-amber-500/25":t==="mismatch"?"border-rose-500 bg-rose-500/15 hover:bg-rose-500/25":"border-slate-400 bg-slate-200/25 hover:bg-slate-200/45"}function Hn(e){return e.y<.04}function zn(e){return e==="paired"?"L":e==="outbound"?"OUT":e==="inbound"?"IN":e==="mismatch"?"ERR":""}function $t(e){return e===null?"No target page":`Page ${e}`}function In(e){const t=F(e),n=e.target_hotspot_id??e.linked_hotspot_id??null,a=e.target_page_no===null?"No target page":`Target page ${e.target_page_no}`;return n!==null?`${a} • ${Oe(t)} (#${n})`:`${a} • ${Oe(t)}`}function Ue(e){return Number.parseFloat(e.toFixed(6))}function Mt(){return JSON.stringify({relation_kind:u.relation_kind,target_page_no:u.target_page_no,target_hotspot_id:u.target_hotspot_id,x:Ue(u.x),y:Ue(u.y),w:Ue(u.w),h:Ue(u.h),label:u.label.trim()})}function Tt(){He.value=Mt()}function Ht(){u.page_id=y.value?.id??0,u.relation_kind="next",u.target_page_no=null,u.target_hotspot_id=null,u.x=0,u.y=0,u.w=0,u.h=0,u.label="",u.clearErrors()}function Ln(e){y.value!==null&&(Ht(),b.value=null,h.value=null,$.value=null,S.value=null,u.x=e.x,u.y=e.y,u.w=e.w,u.h=e.h,Q.value=!0,Tt())}function Z(e){if(y.value===null)return;b.value!==e.id&&(h.value=null),Ht(),b.value=e.id,$.value=e.id,S.value=e.id,u.relation_kind=e.relation_kind,u.target_page_no=e.target_page_no??null;const t=e.target_hotspot_id??e.linked_hotspot_id??null;if(u.target_hotspot_id=t,t!==null){const n=$n(t);n!==null&&(u.target_page_no=n)}u.x=h.value?.x??e.x,u.y=h.value?.y??e.y,u.w=h.value?.w??e.w,u.h=h.value?.h??e.h,u.label=e.label??"",Q.value=!0,Tt()}function zt(){const e=Xe.value;if(e===null)return;const t=x.value.find(n=>n.id===e);t!==void 0&&(Z(t),Xe.value=null)}function ve(){Q.value=!1,$.value=null,S.value=null,ue.value=!1,He.value=null,u.clearErrors()}function It(){if(!u.processing){if(Ne.value){ue.value=!0;return}ve()}}function Nn(){const e=re.value;ve(),e!==null&&(re.value=null,D.value=null,h.value=null,H.value=!1,I.value=null,b.value=null,Y(),Et(e))}function En(e){ue.value=e,e||(re.value=null)}function Pn(e){if(e){Q.value=!0;return}It()}function Lt(e){const t=ye(e);if(t===null)return;const n=x.value.find(m=>m.id===t);if(n!==void 0){Z(n);return}const a=Ct(t);a!==null&&Be.get("/admin/hotspots",{page_id:a.pageId,focus_hotspot_id:t},{preserveScroll:!0,preserveState:!0,replace:!0})}function Vn(){if(y.value===null)return;u.page_id=y.value.id;const e=u.transform(t=>({...t,target_hotspot_id:t.target_page_no===null?null:t.target_hotspot_id,label:t.label.trim()===""?null:t.label.trim()}));if($.value===null){e.post("/admin/hotspots",{preserveScroll:!0,forceFormData:!1,onSuccess:()=>{h.value=null,ve()}});return}e.put(`/admin/hotspots/${$.value}`,{preserveScroll:!0,forceFormData:!1,onSuccess:()=>{h.value=null,ve()}})}function Rn(e){if(y.value===null||h.value===null||xe.value!==null)return;const t=h.value;xe.value=e.id;const n=e.target_hotspot_id??e.linked_hotspot_id??null;Be.put(`/admin/hotspots/${e.id}`,{page_id:y.value.id,relation_kind:e.relation_kind,target_page_no:e.target_page_no,target_hotspot_id:n,x:t.x,y:t.y,w:t.w,h:t.h,label:e.label??""},{preserveScroll:!0,onSuccess:()=>{h.value=null,xe.value=null},onError:()=>{xe.value=null}})}function Nt(e){V.value=e,ie.value=!0}function Fn(){if(V.value===null)return;const e=V.value;Be.delete(`/admin/hotspots/${e.id}`,{preserveScroll:!0,onSuccess:()=>{ie.value=!1,V.value=null}})}function An(e){ie.value=e,e||(V.value=null)}K(ie,e=>{e||(V.value=null)}),K(x,e=>{V.value===null||e.some(n=>n.id===V.value?.id)||(V.value=null,ie.value=!1)});function Et(e){oe.value=e;const t=Number.parseInt(e,10);Number.isNaN(t)||t<=0||Be.get("/admin/hotspots",{page_id:t},{preserveScroll:!0,preserveState:!0,replace:!0})}function Pt(e){if(e==null)return;const t=String(e);if(Q.value){if(Ne.value){re.value=t,ue.value=!0;return}ve()}D.value=null,H.value=!1,I.value=null,b.value=null,h.value=null,Y(),re.value=null,Et(t)}function Vt(e){const t=Ve.value;if(t<0)return;const n=e==="previous"?t-1:t+1,a=v.edition_pages[n];a!==void 0&&Pt(String(a.id))}function Rt(){Vt("previous")}function Ft(){Vt("next")}function At(){z.value=!z.value,z.value||(b.value=null,h.value=null,Y(),D.value=null)}function ke(e){b.value=e.id,h.value=null,S.value=e.id,z.value=!0,Y(),D.value=null,H.value=!1,I.value=null}function nt(){b.value=null,h.value=null,Y(),D.value=null,H.value=!1,I.value=null}function On(){if($.value===null)return;const e=x.value.find(t=>t.id===$.value);e!==void 0&&(ve(),ke(e))}function Ot(e){const t=ut.value;if(t===null||k.value.width<=0||k.value.height<=0)return;const n=e.x*k.value.width,a=e.y*k.value.height,m=e.w*k.value.width,T=e.h*k.value.height,U=Math.max(0,n+m/2-t.clientWidth/2),q=Math.max(0,a+T/2-t.clientHeight/2);t.scrollTo({left:U,top:q,behavior:"smooth"})}function fe(e){P.value=e}function pe(e){return e==="all"?x.value.length:R.value[e]}function Ut(e){S.value=e}function lt(e){$.value!==e&&(S.value=null)}function Un(e,t){if(t instanceof HTMLElement){Ye.set(e,t);return}Ye.delete(e)}function Bn(){te.value="",P.value="all",ne.value="id_asc"}function jn(e){const t=new Set(L.value);t.has(e)?t.delete(e):t.add(e),L.value=[...t].sort((n,a)=>n-a)}function De(e){const t=[...new Set(e)].filter(n=>Number.isInteger(n)&&n>0).sort((n,a)=>n-a);L.value=t}function Bt(){De([])}function Wn(){De(Ee.value)}function Xn(){De(Pe.value)}function jt(e){e==="mismatch"?De(Ee.value):e==="unlinked"&&De(Pe.value),Wt(e)}function Yn(){const e=X.value.map(n=>n.id);if(e.length===0)return;const t=new Set(L.value);if(mt.value)for(const n of e)t.delete(n);else for(const n of e)t.add(n);L.value=[...t].sort((n,a)=>n-a)}function Wt(e="manual"){!Le.value||y.value===null||de.processing||(j.value=e,se.value=!0)}function qn(){!Le.value||y.value===null||(de.page_id=y.value.id,de.hotspot_ids=[...L.value],de.post("/admin/hotspots/bulk-delete",{preserveScroll:!0,forceFormData:!1,onSuccess:()=>{se.value=!1,j.value="manual",Bt()}}))}function Kn(e){se.value=e,e||(j.value="manual")}function Gn(e){if(!(e instanceof HTMLElement))return!1;const t=e.tagName.toLowerCase();return t==="input"||t==="textarea"||e.isContentEditable}function Xt(e){if(!(Q.value||!qe.value||Gn(e.target))){if(e.key==="Escape"&&M.value!==null){e.preventDefault(),Y();return}if(e.key==="Escape"&&b.value!==null){e.preventDefault(),nt();return}if(e.key.toLowerCase()==="d"){e.preventDefault(),At();return}if(e.key.toLowerCase()==="e"&&S.value!==null){const t=x.value.find(n=>n.id===S.value);if(t!==void 0){e.preventDefault(),ke(t);return}}if(e.key.toLowerCase()==="f"&&S.value!==null){const t=x.value.find(n=>n.id===S.value);if(t!==void 0){e.preventDefault(),Ot(t);return}}e.key==="ArrowLeft"&&_t.value&&(e.preventDefault(),Rt()),e.key==="ArrowRight"&&bt.value&&(e.preventDefault(),Ft())}}function Yt(e){un.value&&(e.preventDefault(),e.returnValue="")}return(e,t)=>(f(),_(le,null,[o(l(nl),{title:"Page Hotspots"}),o(pl,{breadcrumbs:tn},{default:s(()=>[i("div",_l,[t[64]||(t[64]=i("div",{class:"space-y-1"},[i("h1",{class:"text-xl font-semibold"},"Mapping Editor"),i("p",{class:"text-sm text-muted-foreground"}," Draw rectangles over a page and connect them to another page or a specific hotspot. ")],-1)),qe.value?(f(),G(l(Gt),{key:0,class:"overflow-hidden"},{default:s(()=>[o(l(il),{class:"space-y-3 border-b bg-muted/20"},{default:s(()=>[i("div",bl,[i("div",hl,[o(l(sl),{class:"flex flex-wrap items-center gap-2"},{default:s(()=>[i("span",null,d(vn.value),1),o(l(J),{variant:"outline"},{default:s(()=>[r(d(v.edition?.edition_date),1)]),_:1}),o(l(J),{variant:v.edition?.status==="published"?"default":"secondary"},{default:s(()=>[r(d(v.edition?.status),1)]),_:1},8,["variant"])]),_:1}),t[21]||(t[21]=i("p",{class:"text-sm text-muted-foreground"}," Draw a rectangle to create a hotspot, then connect it to a page or a specific linked hotspot. ",-1))]),o(l(J),{variant:"outline"},{default:s(()=>[r("Page "+d(y.value?.page_no),1)]),_:1})])]),_:1}),o(l(Jt),{class:"space-y-4 p-4"},{default:s(()=>[v.edition?(f(),G(ll,{key:0,"edition-id":v.edition.id,"edition-date":v.edition.edition_date,"edition-name":v.edition.name,status:v.edition.status,"pages-count":v.edition.pages_count,"published-at":v.edition.published_at,"current-page-no":y.value?.page_no??null,"manage-href":fn.value,"publish-href":pn.value,"mapping-href":gn.value},null,8,["edition-id","edition-date","edition-name","status","pages-count","published-at","current-page-no","manage-href","publish-href","mapping-href"])):C("",!0),i("div",xl,[i("div",wl,[i("div",yl,[t[22]||(t[22]=i("p",{class:"text-xs tracking-wide text-muted-foreground uppercase"}," Selected page ",-1)),i("p",kl," Page "+d(y.value?.page_no),1)]),o(l(Ce),{"model-value":oe.value,"onUpdate:modelValue":Pt},{default:s(()=>[o(l(Se),null,{default:s(()=>[o(l($e),{placeholder:"Select page"})]),_:1}),o(l(Me),null,{default:s(()=>[(f(!0),_(le,null,_e(v.edition_pages,n=>(f(),G(l(A),{key:n.id,value:String(n.id)},{default:s(()=>[r(" Page "+d(n.page_no),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),i("div",Dl,[o(l(g),{size:"sm",variant:"outline",disabled:!_t.value,onClick:Rt},{default:s(()=>[...t[23]||(t[23]=[r(" Previous page ",-1)])]),_:1},8,["disabled"]),o(l(g),{size:"sm",variant:"outline",disabled:!bt.value,onClick:Ft},{default:s(()=>[...t[24]||(t[24]=[r(" Next page ",-1)])]),_:1},8,["disabled"])])]),i("div",Cl,[t[25]||(t[25]=i("p",{class:"text-xs tracking-wide text-muted-foreground uppercase"}," Total pages ",-1)),i("p",Sl,d(v.edition?.pages_count??0),1),i("p",$l," Max page "+d(v.edition?.max_page_no??0),1)]),i("div",Ml,[t[26]||(t[26]=i("p",{class:"text-xs tracking-wide text-muted-foreground uppercase"}," Hotspots on this page ",-1)),i("p",Tl,d(x.value.length),1),i("p",Hl," Linked: "+d(R.value.paired),1)]),i("div",zl,[t[31]||(t[31]=i("p",{class:"text-xs tracking-wide text-muted-foreground uppercase"}," Needs attention ",-1)),i("p",Il,d(R.value.mismatch),1),i("p",Ll," Outbound "+d(R.value.outbound)+" • Inbound "+d(R.value.inbound)+" • Unlinked "+d(R.value.none),1),i("div",Nl,[o(l(g),{size:"sm",variant:"outline",disabled:Ee.value.length===0,onClick:Wn},{default:s(()=>[...t[27]||(t[27]=[r(" Select mismatch ",-1)])]),_:1},8,["disabled"]),o(l(g),{size:"sm",variant:"destructive",disabled:Ee.value.length===0,onClick:t[0]||(t[0]=n=>jt("mismatch"))},{default:s(()=>[...t[28]||(t[28]=[r(" Delete mismatch ",-1)])]),_:1},8,["disabled"]),o(l(g),{size:"sm",variant:"outline",disabled:Pe.value.length===0,onClick:Xn},{default:s(()=>[...t[29]||(t[29]=[r(" Select unlinked ",-1)])]),_:1},8,["disabled"]),o(l(g),{size:"sm",variant:"destructive",disabled:Pe.value.length===0,onClick:t[1]||(t[1]=n=>jt("unlinked"))},{default:s(()=>[...t[30]||(t[30]=[r(" Delete unlinked ",-1)])]),_:1},8,["disabled"])])])]),i("div",El,[i("div",Pl,[i("div",Vl,[i("div",Rl,[o(l(J),{variant:"default"},{default:s(()=>[r("Linked "+d(R.value.paired),1)]),_:1}),o(l(J),{variant:"secondary"},{default:s(()=>[r("Outbound / Inbound "+d(R.value.outbound+R.value.inbound),1)]),_:1}),o(l(J),{variant:"destructive"},{default:s(()=>[r("Mismatch "+d(R.value.mismatch),1)]),_:1}),o(l(J),{variant:"outline"},{default:s(()=>[r("No link "+d(R.value.none),1)]),_:1})]),i("div",Fl,[o(l(g),{size:"sm",variant:z.value?"default":"outline",onClick:At},{default:s(()=>[r(d(z.value?"Draw mode on":"Draw mode off"),1)]),_:1},8,["variant"]),t[32]||(t[32]=i("p",{class:"text-muted-foreground"}," Shortcut: ← / → page, D draw mode, E area edit, F locate ",-1))])]),O.value!==null?(f(),_("div",Al,[i("div",Ol,[i("p",null,[r(" Area edit mode: drag the box to move hotspot #"+d(O.value.id)+" or drag handles to scale in/out. Press ",1),t[33]||(t[33]=i("span",{class:"font-semibold"},"Esc",-1)),t[34]||(t[34]=r(" to cancel. ",-1))])]),o(l(g),{size:"sm",variant:"outline",onClick:nt},{default:s(()=>[...t[35]||(t[35]=[r(" Cancel ",-1)])]),_:1})])):C("",!0),i("div",{ref_key:"canvasViewportRef",ref:ut,class:"overflow-auto rounded-xl border bg-background p-3 shadow-sm"},[i("div",Ul,[i("img",{ref_key:"imageRef",ref:We,src:ze.value,alt:`Page ${y.value?.page_no}`,class:"block h-auto w-full rounded-md",draggable:"false",onLoad:ce},null,40,Bl),k.value.width>0&&k.value.height>0?(f(),_("div",{key:0,class:"pointer-events-none absolute top-0 left-0 overflow-visible",style:ae(vt.value)},[(f(!0),_(le,null,_e(x.value,n=>(f(),_("div",{key:n.id,class:E(["pointer-events-auto absolute rounded-sm border-2 transition-colors",[Tn(n),S.value===n.id?"z-20 ring-2 ring-primary ring-offset-1 ring-offset-background":"z-10"]]),style:ae(Ze(n)),title:In(n),onMouseenter:a=>S.value=n.id,onMouseleave:a=>lt(n.id),onMousedown:w(a=>Dn(n,a),["stop","prevent"]),onTouchstart:w(a=>Cn(n,a),["stop","prevent"])},[F(n)!=="none"?(f(),_("span",Wl,d(zn(F(n))),1)):C("",!0),i("div",{class:E(["absolute z-30 flex items-center gap-0.5 rounded-md border bg-popover/95 p-0.5 shadow-md backdrop-blur-sm",[Hn(n)?"top-0.5 right-0.5":"-top-1 right-0 -translate-y-full"]]),onMousedown:t[2]||(t[2]=w(()=>{},["stop"])),onTouchstart:t[3]||(t[3]=w(()=>{},["stop"])),onClick:t[4]||(t[4]=w(()=>{},["stop"]))},[i("span",Xl," #"+d(n.id),1),o(l(g),{size:"icon-sm",variant:"ghost",class:"size-6",title:"Edit",onClick:a=>Z(n)},{default:s(()=>[o(l(al),{class:"size-3"})]),_:1},8,["onClick"]),o(l(g),{size:"icon-sm",variant:"ghost",class:"size-6",title:"Open linked hotspot",disabled:ye(n)===null,onClick:a=>Lt(n)},{default:s(()=>[o(l(gl),{class:"size-3"})]),_:1},8,["disabled","onClick"]),o(l(g),{size:"icon-sm",variant:"ghost",class:"size-6 text-destructive hover:bg-destructive/10 hover:text-destructive",title:"Delete",onClick:a=>Nt(n)},{default:s(()=>[o(l(ol),{class:"size-3"})]),_:1},8,["onClick"]),b.value===n.id&&h.value!==null?(f(),G(l(g),{key:0,size:"icon-sm",variant:"default",class:"size-6",title:"Save area",disabled:xe.value===n.id,onClick:a=>Rn(n)},{default:s(()=>[o(l(ml),{class:"size-3"})]),_:1},8,["disabled","onClick"])):C("",!0)],34)],46,jl))),128)),O.value!==null&&Ge.value!==null?(f(),_("div",{key:0,class:E(["pointer-events-auto absolute rounded-sm border-2 border-dashed border-blue-700/85 bg-blue-600/10",M.value!==null?"cursor-grabbing":"cursor-move"]),style:ae(Ze(Ge.value)),onMousedown:t[5]||(t[5]=w(n=>kt("move",n),["stop","prevent"])),onTouchstart:t[6]||(t[6]=w(n=>Dt("move",n),["stop","prevent"]))},[(f(),_(le,null,_e(nn,n=>i("button",{key:`resize-handle-${n}`,type:"button",class:E(["absolute z-10 h-3 w-3 rounded-full border border-white bg-blue-700 shadow-sm",yn(n)]),style:ae(kn(n)),onMousedown:w(a=>kt(n,a),["stop","prevent"]),onTouchstart:w(a=>Dt(n,a),["stop","prevent"])},null,46,Yl)),64))],38)):C("",!0),sn.value&&D.value!==null&&O.value===null?(f(),_("div",{key:1,class:"absolute rounded-sm border-2 border-blue-500 bg-blue-500/15",style:ae(Ze(D.value))},null,4)):C("",!0)],4)):C("",!0),z.value&&O.value===null&&k.value.width>0&&k.value.height>0?(f(),_("div",{key:1,class:"absolute top-0 left-0 cursor-crosshair touch-none",style:ae(vt.value),onMousedown:_n,onMousemove:bn,onMouseup:hn,onTouchstart:w(xn,["prevent"]),onTouchmove:w(wn,["prevent"]),onTouchend:w(yt,["prevent"]),onTouchcancel:w(yt,["prevent"])},null,36)):C("",!0),!z.value&&k.value.width>0&&k.value.height>0?(f(),_("div",ql," Draw mode off ")):C("",!0)])],512)]),i("div",Kl,[i("div",Gl,[i("div",null,[t[36]||(t[36]=i("h2",{class:"text-sm font-semibold"}," Existing hotspots ",-1)),i("p",Jl,d(X.value.length)+" of "+d(x.value.length)+" shown ",1)]),o(l(J),{variant:"outline"},{default:s(()=>[r(d(x.value.length),1)]),_:1})]),i("div",Ql,[o(l(Qt),{modelValue:te.value,"onUpdate:modelValue":t[7]||(t[7]=n=>te.value=n),type:"text",placeholder:"Search by id, relation, page, label, or link"},null,8,["modelValue"]),i("div",Zl,[t[41]||(t[41]=i("p",{class:"text-xs font-medium tracking-wide text-muted-foreground uppercase"}," Sort ",-1)),o(l(Ce),{modelValue:ne.value,"onUpdate:modelValue":t[8]||(t[8]=n=>ne.value=n)},{default:s(()=>[o(l(Se),null,{default:s(()=>[o(l($e),{placeholder:"Sort hotspots"})]),_:1}),o(l(Me),null,{default:s(()=>[o(l(A),{value:"id_asc"},{default:s(()=>[...t[37]||(t[37]=[r("ID (oldest first)",-1)])]),_:1}),o(l(A),{value:"id_desc"},{default:s(()=>[...t[38]||(t[38]=[r("ID (newest first)",-1)])]),_:1}),o(l(A),{value:"target_page"},{default:s(()=>[...t[39]||(t[39]=[r("Target page",-1)])]),_:1}),o(l(A),{value:"relation"},{default:s(()=>[...t[40]||(t[40]=[r("Relation kind",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",ea,[o(l(g),{size:"sm",variant:"outline",class:E(P.value==="all"?"border-primary bg-primary/10 text-primary":""),onClick:t[9]||(t[9]=n=>fe("all"))},{default:s(()=>[r(" All "+d(pe("all")),1)]),_:1},8,["class"]),o(l(g),{size:"sm",variant:"outline",class:E(P.value==="paired"?"border-primary bg-primary/10 text-primary":""),onClick:t[10]||(t[10]=n=>fe("paired"))},{default:s(()=>[r(" Linked "+d(pe("paired")),1)]),_:1},8,["class"]),o(l(g),{size:"sm",variant:"outline",class:E(P.value==="outbound"?"border-primary bg-primary/10 text-primary":""),onClick:t[11]||(t[11]=n=>fe("outbound"))},{default:s(()=>[r(" Out "+d(pe("outbound")),1)]),_:1},8,["class"]),o(l(g),{size:"sm",variant:"outline",class:E(P.value==="inbound"?"border-primary bg-primary/10 text-primary":""),onClick:t[12]||(t[12]=n=>fe("inbound"))},{default:s(()=>[r(" In "+d(pe("inbound")),1)]),_:1},8,["class"]),o(l(g),{size:"sm",variant:"outline",class:E(P.value==="mismatch"?"border-primary bg-primary/10 text-primary":""),onClick:t[13]||(t[13]=n=>fe("mismatch"))},{default:s(()=>[r(" Mismatch "+d(pe("mismatch")),1)]),_:1},8,["class"]),o(l(g),{size:"sm",variant:"outline",class:E(P.value==="none"?"border-primary bg-primary/10 text-primary":""),onClick:t[14]||(t[14]=n=>fe("none"))},{default:s(()=>[r(" No link "+d(pe("none")),1)]),_:1},8,["class"])]),i("div",ta,[te.value.trim()!==""?(f(),G(l(g),{key:0,size:"sm",variant:"ghost",class:"w-fit",onClick:t[15]||(t[15]=n=>te.value="")},{default:s(()=>[...t[42]||(t[42]=[r(" Clear search ",-1)])]),_:1})):C("",!0),mn.value?(f(),G(l(g),{key:1,size:"sm",variant:"outline",class:"w-fit",onClick:Bn},{default:s(()=>[...t[43]||(t[43]=[r(" Reset filters ",-1)])]),_:1})):C("",!0)]),i("div",na,[i("div",la,[i("p",null," Selected "+d(we.value)+" hotspot(s) ",1),i("p",null," Visible selected "+d(gt.value)+"/"+d(X.value.length),1)]),i("div",aa,[o(l(g),{size:"sm",variant:"outline",disabled:X.value.length===0,onClick:Yn},{default:s(()=>[r(d(mt.value?"Unselect shown":"Select shown"),1)]),_:1},8,["disabled"]),o(l(g),{size:"sm",variant:"ghost",disabled:!Le.value,onClick:Bt},{default:s(()=>[...t[44]||(t[44]=[r(" Clear selected ",-1)])]),_:1},8,["disabled"]),o(l(g),{size:"sm",variant:"destructive",disabled:!Le.value||l(de).processing,onClick:Wt},{default:s(()=>[...t[45]||(t[45]=[r(" Delete selected ",-1)])]),_:1},8,["disabled","onClick"])])])]),i("div",oa,[(f(!0),_(le,null,_e(X.value,n=>(f(),_("div",{key:n.id,ref_for:!0,ref:a=>Un(n.id,a),role:"button",tabindex:"0",class:E(["group cursor-pointer space-y-3 rounded-lg border bg-card p-3 shadow-sm transition hover:border-primary/40",[S.value===n.id?"border-primary bg-primary/5":"",Ie.value.has(n.id)?"border-destructive/40 bg-destructive/5":""]]),onMouseenter:a=>Ut(n.id),onMouseleave:a=>lt(n.id),onFocus:a=>Ut(n.id),onBlur:a=>lt(n.id),onClick:a=>Z(n),onKeydown:[Kt(w(a=>Z(n),["prevent"]),["enter"]),Kt(w(a=>Z(n),["prevent"]),["space"])]},[i("div",sa,[i("label",{class:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",onClick:t[16]||(t[16]=w(()=>{},["stop"]))},[i("input",{type:"checkbox",class:"h-4 w-4 rounded border-border text-primary focus:ring-primary",checked:Ie.value.has(n.id),onChange:w(a=>jn(n.id),["stop"])},null,40,ua),i("span",ra,"Select hotspot "+d(n.id),1)]),i("div",da,[ze.value!==""?(f(),_("img",{key:0,src:ze.value,alt:"",class:"pointer-events-none absolute select-none",draggable:"false",style:ae(Sn(n))},null,12,ca)):(f(),_("div",va," No preview "))]),i("div",fa,[i("div",pa,[i("p",ga," #"+d(n.id),1),o(l(J),{variant:Mn(F(n))},{default:s(()=>[r(d(Oe(F(n))),1)]),_:2},1032,["variant"])]),i("p",ma,d(n.relation_kind)+" → "+d($t(n.target_page_no)),1),n.target_hotspot_id||n.linked_hotspot_id?(f(),_("p",_a,[r(" Linked hotspot: #"+d(n.target_hotspot_id??n.linked_hotspot_id)+" ",1),St(n)!==null?(f(),_("span",ba," (Page "+d(St(n))+") ",1)):C("",!0)])):C("",!0),n.label?(f(),_("p",ha,d(n.label),1)):C("",!0)])]),i("div",{class:E(["flex max-h-0 flex-wrap gap-2 overflow-hidden opacity-0 transition-all duration-200 group-focus-within:max-h-20 group-focus-within:opacity-100 group-hover:max-h-20 group-hover:opacity-100",[S.value===n.id||Ie.value.has(n.id)?"!max-h-20 !opacity-100":""]])},[o(l(g),{size:"sm",variant:"outline",class:"flex-1 sm:flex-none",onClick:w(a=>Ot(n),["stop"])},{default:s(()=>[...t[46]||(t[46]=[r(" Locate ",-1)])]),_:1},8,["onClick"]),o(l(g),{size:"sm",variant:"outline",class:"flex-1 sm:flex-none",onClick:w(a=>Z(n),["stop"])},{default:s(()=>[...t[47]||(t[47]=[r(" Edit ",-1)])]),_:1},8,["onClick"]),o(l(g),{size:"sm",variant:b.value===n.id?"default":"outline",class:"flex-1 sm:flex-none",onClick:w(a=>b.value===n.id?nt():ke(n),["stop"])},{default:s(()=>[r(d(b.value===n.id?"Cancel area edit":"Drag area"),1)]),_:2},1032,["variant","onClick"]),o(l(g),{size:"sm",variant:"secondary",class:"flex-1 sm:flex-none",disabled:ye(n)===null,onClick:w(a=>Lt(n),["stop"])},{default:s(()=>[...t[48]||(t[48]=[r(" Open linked ",-1)])]),_:1},8,["disabled","onClick"]),o(l(g),{size:"sm",variant:"destructive",class:"flex-1 sm:flex-none",onClick:w(a=>Nt(n),["stop"])},{default:s(()=>[...t[49]||(t[49]=[r(" Delete ",-1)])]),_:1},8,["onClick"])],2)],42,ia))),128)),X.value.length===0&&x.value.length>0?(f(),_("p",xa," No hotspots match your search. ")):C("",!0),x.value.length===0?(f(),_("p",wa," No hotspots yet. Draw a rectangle on the page image to create one. ")):C("",!0)])])])]),_:1})]),_:1})):(f(),G(l(Gt),{key:1},{default:s(()=>[o(l(Jt),{class:"py-6 text-sm text-muted-foreground"},{default:s(()=>[...t[50]||(t[50]=[r(" No pages found yet. Upload pages first, then open mapping. ",-1)])]),_:1})]),_:1})),o(l(ul),{open:Q.value,"onUpdate:open":Pn},{default:s(()=>[o(l(rl),{class:"sm:max-w-2xl"},{default:s(()=>[o(l(dl),null,{default:s(()=>[o(l(cl),null,{default:s(()=>[r(d(an.value),1)]),_:1}),o(l(vl),null,{default:s(()=>[...t[51]||(t[51]=[r(" Configure relation and optional target references. Target page and target hotspot can both be empty. ",-1)])]),_:1})]),_:1}),Ne.value?(f(),_("p",ya," You have unsaved changes in this hotspot form. ")):C("",!0),i("div",ka,[i("div",Da,[t[59]||(t[59]=i("p",{class:"text-xs font-medium tracking-wide text-muted-foreground uppercase"}," Link settings ",-1)),i("div",Ca,[i("div",Sa,[t[54]||(t[54]=i("label",{class:"text-sm font-medium"},"Relation kind",-1)),o(l(Ce),{modelValue:l(u).relation_kind,"onUpdate:modelValue":t[17]||(t[17]=n=>l(u).relation_kind=n)},{default:s(()=>[o(l(Se),null,{default:s(()=>[o(l($e),{placeholder:"Select relation"})]),_:1}),o(l(Me),null,{default:s(()=>[o(l(A),{value:"next"},{default:s(()=>[...t[52]||(t[52]=[r("next",-1)])]),_:1}),o(l(A),{value:"previous"},{default:s(()=>[...t[53]||(t[53]=[r("previous",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(je,{message:l(u).errors.relation_kind},null,8,["message"])]),i("div",$a,[t[56]||(t[56]=i("label",{class:"text-sm font-medium"},"Target page",-1)),o(l(Ce),{modelValue:dt.value,"onUpdate:modelValue":t[18]||(t[18]=n=>dt.value=n)},{default:s(()=>[o(l(Se),null,{default:s(()=>[o(l($e),{placeholder:"No target page"})]),_:1}),o(l(Me),null,{default:s(()=>[o(l(A),{value:"__none"},{default:s(()=>[...t[55]||(t[55]=[r(" No target page ",-1)])]),_:1}),(f(!0),_(le,null,_e(ln.value,n=>(f(),G(l(A),{key:n,value:String(n)},{default:s(()=>[r(" Page "+d(n),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),o(je,{message:l(u).errors.target_page_no},null,8,["message"])])]),i("div",Ma,[t[58]||(t[58]=i("label",{class:"text-sm font-medium"},"Target hotspot (optional)",-1)),o(l(Ce),{modelValue:ct.value,"onUpdate:modelValue":t[19]||(t[19]=n=>ct.value=n),disabled:l(u).target_page_no===null},{default:s(()=>[o(l(Se),null,{default:s(()=>[o(l($e),{placeholder:l(u).target_page_no===null?"Select target page first":"Any hotspot on target page"},null,8,["placeholder"])]),_:1}),o(l(Me),null,{default:s(()=>[o(l(A),{value:"__none"},{default:s(()=>[...t[57]||(t[57]=[r("Any hotspot on target page",-1)])]),_:1}),(f(!0),_(le,null,_e(rt.value,n=>(f(),G(l(A),{key:n.id,value:String(n.id)},{default:s(()=>[r(" #"+d(n.id)+" ",1),n.label?(f(),_("span",Ta," - "+d(n.label),1)):C("",!0),i("span",Ha," ("+d(n.relation_kind)+" → "+d($t(n.target_page_no))+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),o(je,{message:l(u).errors.target_hotspot_id},null,8,["message"])])]),i("div",za,[i("div",Ia,[t[60]||(t[60]=i("label",{class:"text-sm font-medium"},"Label (optional)",-1)),o(l(Qt),{modelValue:l(u).label,"onUpdate:modelValue":t[20]||(t[20]=n=>l(u).label=n),placeholder:"Optional label"},null,8,["modelValue"]),o(je,{message:l(u).errors.label},null,8,["message"])]),$.value!==null?(f(),_("div",La,[t[62]||(t[62]=i("p",{class:"text-xs text-muted-foreground"}," Need a new area? Drag-select directly on the page image. ",-1)),o(l(g),{size:"sm",variant:"outline",onClick:On},{default:s(()=>[...t[61]||(t[61]=[r(" Edit area by drag ",-1)])]),_:1})])):C("",!0)])]),o(l(fl),null,{default:s(()=>[o(l(g),{variant:"outline",disabled:l(u).processing,onClick:It},{default:s(()=>[...t[63]||(t[63]=[r(" Cancel ",-1)])]),_:1},8,["disabled"]),o(l(g),{disabled:l(u).processing,onClick:Vn},{default:s(()=>[r(d(on.value),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),o(st,{open:ie.value,title:"Delete hotspot?",description:V.value===null?"This action cannot be undone.":`Delete hotspot #${V.value.id}? This action cannot be undone.`,"confirm-text":"Delete","confirm-variant":"destructive","onUpdate:open":An,onConfirm:Fn},null,8,["open","description"]),o(st,{open:se.value,title:rn.value,description:cn.value,"confirm-text":dn.value,"confirm-variant":"destructive",processing:l(de).processing,"onUpdate:open":Kn,onConfirm:qn},null,8,["open","title","description","confirm-text","processing"]),o(st,{open:ue.value,title:"Discard unsaved changes?",description:"Your hotspot form has unsaved changes. Discard them and close?","confirm-text":"Discard changes","confirm-variant":"destructive","onUpdate:open":En,onConfirm:Nn},null,8,["open"])])]),_:1})],64))}});export{io as default};
