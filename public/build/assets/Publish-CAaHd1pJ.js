import{d as Q,x as S,I as R,z as W,o as u,c as _,e as a,f as e,h as X,w as t,a as d,J as n,P,K as r,k as b,j as h,F as w,L as F,G as Y,p,M as Z}from"./app-BIDwooZD.js";import{a as ee,_ as te}from"./index-CR_w27Kk.js";import{_ as ae}from"./AlertTitle.vue_vue_type_script_setup_true_lang-C9ceEc2p.js";import{_ as y}from"./index-Y7wIGGvX.js";import{_ as c}from"./index-C8P2q1AW.js";import{_ as E,a as L,b as M,c as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-ChP2b989.js";import{_ as se,a as le,b as ie,c as ne,d as re}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DvCkWFlb.js";import{_ as ue}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Cg5QyE-8.js";import{_ as de}from"./Input.vue_vue_type_script_setup_true_lang-B1SXL9YZ.js";import{_ as oe}from"./EpAdminLayout.vue_vue_type_script_setup_true_lang-C7XcxSU8.js";import"./Primitive-BLKkOots.js";import"./useForwardPropsEmits-ljZNR3_O.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-DSMqO86V.js";import"./chevron-right-CAogZLbH.js";import"./VisuallyHidden-Cp8joezf.js";import"./createLucideIcon-ccUrNrU9.js";import"./RovingFocusGroup-CSddD9ru.js";import"./newspaper-BTZbB5ry.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-rq6uf0wM.js";const fe={class:"space-y-4 p-4"},me={class:"flex flex-col gap-2 sm:flex-row sm:flex-wrap sm:items-center"},_e={key:0,class:"text-sm text-destructive"},pe={key:1,class:"text-sm text-muted-foreground"},ce={class:"flex flex-wrap items-center gap-2"},ve={class:"text-sm font-semibold"},be={key:0,class:"text-xs text-muted-foreground"},he={class:"list-disc space-y-1 pl-4 text-sm"},ge={key:2,class:"text-sm text-muted-foreground"},xe={class:"flex flex-wrap gap-2"},He=Q({__name:"Publish",props:{date:{},date_error:{},date_notice:{},selected_edition_id:{},editions_for_date:{}},setup(T){const o=T,H=[{title:"Publish Editions",href:"/admin/editions/publish"}],f=S(o.date),g=S(!1),x=S("publish"),$=S(null),m=R({edition_id:0});W(()=>o.date,i=>{f.value=i});const k=p(()=>o.editions_for_date??[]),I=p(()=>k.value.length>0),U=p(()=>x.value==="publish"?"Publish":"Unpublish"),O=p(()=>x.value==="publish"?"/admin/editions/publish":"/admin/editions/unpublish"),v=p(()=>$.value===null?null:k.value.find(i=>i.id===$.value)??null),j=p(()=>m.processing||v.value===null?!0:x.value==="publish"?v.value.publish_readiness.is_ready!==!0:!1),G=p(()=>f.value!==""?`/admin/editions/manage?date=${f.value}`:"/admin/editions/manage"),J=p(()=>f.value!==""?`/admin/editions/manage?date=${f.value}`:"/admin/editions/manage");function z(i){return typeof i.name=="string"&&i.name.trim()!==""?i.name.trim():`Edition ${i.id}`}function B(i){return i===null||i.trim()===""?null:new Date(i).toLocaleString()}function D(i){return o.selected_edition_id===i}function N(i){return m.processing&&m.edition_id===i}function K(){Z.get("/admin/editions/publish",{date:f.value!==""?f.value:void 0},{preserveScroll:!0,preserveState:!0,replace:!0})}function A(i,s){i==="publish"&&s.publish_readiness.is_ready!==!0||(x.value=i,$.value=s.id,m.clearErrors(),g.value=!0)}function q(){v.value!==null&&(m.edition_id=v.value.id,m.post(O.value,{preserveScroll:!0,onSuccess:()=>{g.value=!1,$.value=null}}))}return(i,s)=>(u(),_(w,null,[a(e(X),{title:"Publish Editions"}),a(oe,{breadcrumbs:H},{default:t(()=>[d("div",fe,[s[12]||(s[12]=d("div",{class:"space-y-2"},[d("h1",{class:"text-xl font-semibold"},"Publish Editions"),d("p",{class:"text-sm text-muted-foreground"}," Search by date, then publish or unpublish any edition from the list. ")],-1)),a(e(E),null,{default:t(()=>[a(e(L),null,{default:t(()=>[a(e(M),null,{default:t(()=>[...s[3]||(s[3]=[n("Search editions by date",-1)])]),_:1})]),_:1}),a(e(V),{class:"space-y-3"},{default:t(()=>[d("div",me,[a(e(de),{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=l=>f.value=l),type:"date",class:"sm:max-w-xs"},null,8,["modelValue"]),a(e(c),{onClick:K},{default:t(()=>[...s[4]||(s[4]=[n("Search",-1)])]),_:1}),a(e(c),{"as-child":"",variant:"outline"},{default:t(()=>[a(e(P),{href:G.value},{default:t(()=>[...s[5]||(s[5]=[n("Open in Manage Pages",-1)])]),_:1},8,["href"])]),_:1})]),o.date_error?(u(),_("p",_e,r(o.date_error),1)):b("",!0),o.date_notice?(u(),_("p",pe,r(o.date_notice),1)):b("",!0)]),_:1})]),_:1}),I.value?(u(),h(e(E),{key:0},{default:t(()=>[a(e(L),null,{default:t(()=>[a(e(M),{class:"flex flex-wrap items-center gap-2"},{default:t(()=>[d("span",null,"Editions for "+r(o.date),1),a(e(y),{variant:"secondary"},{default:t(()=>[n(r(k.value.length),1)]),_:1})]),_:1})]),_:1}),a(e(V),{class:"space-y-3"},{default:t(()=>[(u(!0),_(w,null,F(k.value,l=>(u(),_("article",{key:l.id,class:Y(["space-y-3 rounded-lg border border-border/70 bg-card p-4",D(l.id)?"ring-1 ring-primary/40":""])},[d("div",ce,[d("p",ve,r(z(l)),1),a(e(y),{variant:"outline"},{default:t(()=>[n(r(l.edition_date),1)]),_:2},1024),a(e(y),{variant:l.status==="published"?"default":"secondary"},{default:t(()=>[n(r(l.status),1)]),_:2},1032,["variant"]),a(e(y),{variant:"outline"},{default:t(()=>[n(r(l.pages_count)+" "+r(l.pages_count===1?"page":"pages"),1)]),_:2},1024),D(l.id)?(u(),h(e(y),{key:0,variant:"outline"},{default:t(()=>[...s[6]||(s[6]=[n("Selected",-1)])]),_:1})):b("",!0)]),B(l.published_at)?(u(),_("p",be," Published at: "+r(B(l.published_at)),1)):b("",!0),l.status==="draft"&&l.publish_readiness.blockers.length>0?(u(),h(e(ee),{key:1,class:"border-destructive/40 text-destructive"},{default:t(()=>[a(e(ae),null,{default:t(()=>[...s[7]||(s[7]=[n("Cannot publish yet",-1)])]),_:1}),a(e(te),null,{default:t(()=>[d("ul",he,[(u(!0),_(w,null,F(l.publish_readiness.blockers,C=>(u(),_("li",{key:C},r(C),1))),128))])]),_:2},1024)]),_:2},1024)):b("",!0),l.status==="draft"&&l.publish_readiness.is_ready?(u(),_("p",ge," This edition is ready to publish. ")):b("",!0),d("div",xe,[a(e(c),{"as-child":"",size:"sm",variant:"outline"},{default:t(()=>[a(e(P),{href:`/admin/editions/manage?date=${l.edition_date}&edition_id=${l.id}`},{default:t(()=>[...s[8]||(s[8]=[n(" Manage ",-1)])]),_:1},8,["href"])]),_:2},1024),l.status==="published"?(u(),h(e(c),{key:0,size:"sm",variant:"destructive",disabled:e(m).processing,onClick:C=>A("unpublish",l)},{default:t(()=>[n(r(N(l.id)?"Unpublishing...":"Unpublish"),1)]),_:2},1032,["disabled","onClick"])):(u(),h(e(c),{key:1,size:"sm",disabled:e(m).processing||!l.publish_readiness.is_ready,onClick:C=>A("publish",l)},{default:t(()=>[n(r(N(l.id)?"Publishing...":"Publish"),1)]),_:2},1032,["disabled","onClick"]))])],2))),128))]),_:1})]),_:1})):(u(),h(e(E),{key:1},{default:t(()=>[a(e(V),{class:"space-y-3 py-6 text-sm text-muted-foreground"},{default:t(()=>[s[10]||(s[10]=d("p",null,"Select a date and click Search to load existing editions.",-1)),a(e(c),{"as-child":"",variant:"outline",class:"w-full sm:w-auto"},{default:t(()=>[a(e(P),{href:J.value},{default:t(()=>[...s[9]||(s[9]=[n("Create draft edition in Manage Pages",-1)])]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})),a(e(se),{open:g.value,"onUpdate:open":s[2]||(s[2]=l=>g.value=l)},{default:t(()=>[a(e(le),null,{default:t(()=>[a(e(ie),null,{default:t(()=>[a(e(ne),null,{default:t(()=>[n(r(U.value)+" this edition?",1)]),_:1}),a(e(re),null,{default:t(()=>[n(" This will change status for "+r(v.value?`${z(v.value)} (${v.value.edition_date})`:"the selected edition")+". ",1)]),_:1})]),_:1}),a(e(ue),null,{default:t(()=>[a(e(c),{variant:"outline",disabled:e(m).processing,onClick:s[1]||(s[1]=l=>g.value=!1)},{default:t(()=>[...s[11]||(s[11]=[n(" Cancel ",-1)])]),_:1},8,["disabled"]),a(e(c),{variant:x.value==="publish"?"default":"destructive",disabled:j.value,onClick:q},{default:t(()=>[n(r(U.value),1)]),_:1},8,["variant","disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1})],64))}});export{He as default};
