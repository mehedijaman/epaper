import{d as Y,o as r,c as d,O as de,a as i,G as Z,F as M,L as I,p,K as b,A as ce,T as Pe,Q as ge,e as o,f as l,w as u,x as h,z as N,B as se,h as De,j,J as B,n as Se,k as re,M as q}from"./app-pbFrJQ1g.js";import{_ as C}from"./index-C7XH55Ot.js";import{c as P}from"./createLucideIcon-Dlt7ezm_.js";import{C as Ne}from"./chevron-right-BL-wNo7u.js";import{_ as Ce,a as Ie}from"./index-7fT0rfcv.js";import{_ as Ee}from"./Input.vue_vue_type_script_setup_true_lang-usT0mv6o.js";import{a as J,b as K,c as Q,d as W,_ as X}from"./SelectValue.vue_vue_type_script_setup_true_lang-BR1WuhBE.js";import{N as ue}from"./newspaper-DOM4mVgu.js";import{C as Te}from"./circle-alert-DwZDizf4.js";const Re=P("CalendarDaysIcon",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);const Ue=P("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);const Fe=P("Grid2x2Icon",[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 12h18",key:"1i2n21"}],["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}]]);const je=P("ListIcon",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);const He=P("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);const Le=P("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]);const Be=P("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Oe=["title","onClick"],Ve=["src","alt"],Ae=Y({__name:"ThumbnailRail",props:{pages:{},activePageNo:{},mode:{default:"strip"},railHeight:{default:null}},emits:["select"],setup(s,{emit:a}){const c=s,g=a,$=p(()=>c.mode==="grid"?"grid grid-cols-2 gap-2":"flex flex-col gap-2"),w=p(()=>c.railHeight===null||c.railHeight<=0?{}:{height:`${c.railHeight}px`});function k(m){g("select",m)}return(m,E)=>(r(),d("aside",{class:"h-full min-h-0 overflow-y-auto border-r border-slate-200 bg-slate-50 p-2",style:de(w.value)},[i("div",{class:Z($.value)},[(r(!0),d(M,null,I(s.pages,f=>(r(),d("button",{key:f.id,type:"button",class:Z(["group w-full overflow-hidden rounded-lg border bg-white p-1 text-left transition-all hover:shadow-md focus-visible:ring-2 focus-visible:ring-sky-400 focus-visible:outline-none",f.page_no===s.activePageNo?"border-sky-500 shadow-sm ring-1 ring-sky-500":"border-slate-200 hover:border-slate-300"]),title:`Go to page ${f.page_no}`,onClick:D=>k(f.page_no)},[i("img",{src:f.image_thumb_url,alt:`Page ${f.page_no}`,loading:"lazy",class:"h-auto w-full rounded"},null,8,Ve),i("p",{class:Z(["mt-1 text-center text-[11px] font-medium",f.page_no===s.activePageNo?"text-sky-700":"text-slate-500 group-hover:text-slate-700"])},b(f.page_no),3)],10,Oe))),128))],2)],4))}}),Ge={class:"flex flex-col rounded-xl border border-slate-200 bg-white shadow-md"},Ze=["src","alt"],qe=["href","aria-label"],Je={class:"flex shrink-0 items-center justify-between gap-2 border-t border-slate-200 bg-white px-3 py-2"},Ke={class:"flex items-center gap-1.5"},Qe={class:"min-w-[4rem] text-center text-sm font-medium text-slate-700 tabular-nums"},We={class:"flex items-center gap-1"},Xe=Y({__name:"ViewerFrame",props:{page:{},editionDate:{},selectedEditionId:{default:null},totalPages:{},prevPageNo:{},nextPageNo:{},enablePanzoom:{type:Boolean,default:!0}},emits:["previous","next"],setup(s,{emit:a}){const c=s,g=a,$=h(null),w=h(null),k=h(null),m=h(null);function E(_){return _.image_large_url||_.image_original_url}function f(_){const v=`/epaper/${c.editionDate}/page/${c.page.page_no}/hotspot/${_.id}`;return c.selectedEditionId===null||c.selectedEditionId<=0?v:`${v}?edition=${c.selectedEditionId}`}function D(){m.value?.reset()}function S(){m.value?.zoomIn()}function z(){m.value?.zoomOut()}return ce(()=>{!c.enablePanzoom||w.value===null||(m.value=Pe(w.value,{maxScale:6,minScale:1,contain:"outside"}))}),ge(()=>{m.value?.destroy()}),(_,v)=>(r(),d("div",Ge,[i("div",{ref_key:"viewportRef",ref:$,class:"flex items-start justify-center overflow-visible bg-slate-50 p-2 sm:p-3"},[i("div",{ref_key:"stageRef",ref:w,class:"relative mx-auto inline-block w-full touch-none select-none"},[i("img",{ref_key:"imageRef",ref:k,src:E(s.page),alt:`Page ${s.page.page_no}`,draggable:"false",class:"block h-auto w-full object-contain"},null,8,Ze),(r(!0),d(M,null,I(s.page.hotspots,x=>(r(),d("a",{key:x.id,href:f(x),target:"_blank",rel:"noopener noreferrer",class:"hotspot-overlay absolute z-20 block rounded-sm border border-transparent bg-transparent transition-all duration-150 focus-visible:ring-2 focus-visible:ring-sky-400/80 focus-visible:outline-none",style:de({left:`${x.x*100}%`,top:`${x.y*100}%`,width:`${x.w*100}%`,height:`${x.h*100}%`}),"aria-label":`Hotspot to page ${x.target_page_no}`},null,12,qe))),128))],512)],512),i("div",Je,[i("div",Ke,[o(l(C),{variant:"ghost",size:"icon-sm",disabled:s.prevPageNo===null,title:"Previous page",onClick:v[0]||(v[0]=x=>g("previous"))},{default:u(()=>[o(l(Ue),{class:"size-4"})]),_:1},8,["disabled"]),i("span",Qe,b(s.page.page_no)+" / "+b(s.totalPages),1),o(l(C),{variant:"ghost",size:"icon-sm",disabled:s.nextPageNo===null,title:"Next page",onClick:v[1]||(v[1]=x=>g("next"))},{default:u(()=>[o(l(Ne),{class:"size-4"})]),_:1},8,["disabled"])]),i("div",We,[o(l(C),{variant:"ghost",size:"icon-sm",title:"Zoom out",onClick:z},{default:u(()=>[o(l(Le),{class:"size-4"})]),_:1}),o(l(C),{variant:"ghost",size:"icon-sm",title:"Zoom in",onClick:S},{default:u(()=>[o(l(Be),{class:"size-4"})]),_:1}),o(l(C),{variant:"ghost",size:"icon-sm",title:"Reset zoom",onClick:D},{default:u(()=>[o(l(He),{class:"size-4"})]),_:1})])])]))}}),Ye=(s,a)=>{const c=s.__vccOpts||s;for(const[g,$]of a)c[g]=$;return c},et=Ye(Xe,[["__scopeId","data-v-a0f56590"]]),tt={class:"flex min-h-screen flex-col bg-slate-100 text-slate-900"},at={class:"border-b border-slate-200 bg-white shadow-sm"},nt={class:"mx-auto flex max-w-7xl items-center justify-center px-4 py-3"},lt=["src"],it={key:1,class:"inline-flex items-center gap-2"},ot={class:"mx-auto w-full max-w-7xl flex-1 px-2 py-3 sm:px-4"},st={class:"rounded-xl border border-slate-200 bg-white shadow-sm"},rt={class:"sticky top-0 z-30 border-b border-slate-200 bg-white/95 px-3 py-2.5 backdrop-blur-sm"},ut={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},dt={class:"flex w-full flex-wrap items-center gap-2 sm:w-auto"},ct={class:"min-w-[140px] flex-1 basis-[160px] sm:w-[170px] sm:flex-none"},gt={class:"min-w-[160px] flex-1 basis-[180px] sm:w-[220px] sm:flex-none"},pt={class:"min-w-[100px] flex-1 basis-[110px] sm:w-[110px] sm:flex-none"},ft={id:"public-viewer-dates"},mt=["value"],vt={key:0,class:"mt-1.5 text-xs text-slate-500"},ht={key:0,class:"grid items-stretch lg:grid-cols-[140px_minmax(0,1fr)]"},_t={class:"mx-auto max-w-5xl"},xt={key:1,class:"flex items-center justify-center p-12 text-sm text-slate-500"},yt={class:"border-t border-slate-200 bg-white py-4"},bt={class:"mx-auto flex max-w-7xl flex-col gap-4 px-4 text-xs text-slate-600 sm:flex-row sm:items-end sm:justify-between sm:text-sm"},wt={class:"space-y-2 text-center sm:text-left"},kt=["src"],$t={key:1,class:"inline-flex items-center gap-2"},zt={class:"text-slate-500"},Mt={class:"max-w-lg space-y-1 text-center text-slate-500 sm:text-right"},Pt={key:0,class:"pointer-events-none fixed top-4 right-4 z-50 w-full max-w-sm"},Ft=Y({__name:"PublicViewerShell",props:{title:{},editionDate:{},page:{},pages:{},categories:{default:()=>[]},editionsForDate:{default:()=>[]},selectedEdition:{default:null},availableDates:{},logoUrl:{default:null},settings:{},adsBySlot:{default:void 0}},setup(s){const a=s;function c(e=new Date){const t=new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(e),n=t.find(F=>F.type==="year")?.value??"",U=t.find(F=>F.type==="month")?.value??"",oe=t.find(F=>F.type==="day")?.value??"";return n!==""&&U!==""&&oe!==""?`${n}-${U}-${oe}`:""}const g=h(c()),$=h(a.page?String(a.page.page_no):""),w=h(""),k=h(""),m=h("strip"),E=h(null),f=h(null),D=h(null),S=h("");let z=null,_=null;const v=p(()=>a.editionDate!==null&&a.page!==null&&y.value.length>0),x=p(()=>a.page?.page_no??0),y=p(()=>{if(a.page===null)return[...a.pages].sort((t,n)=>t.page_no-n.page_no);const e=a.pages.filter(t=>t.edition_id===a.page?.edition_id);return e.length===0?[{id:a.page.id,edition_id:a.page.edition_id,page_no:a.page.page_no,category_id:a.page.category_id,category_name:a.page.category_name,image_thumb_url:a.page.image_thumb_url,image_large_url:a.page.image_large_url,image_original_url:a.page.image_original_url,hotspots:a.page.hotspots}]:e.sort((t,n)=>t.page_no-n.page_no)}),pe=p(()=>{const e=new Map;for(const t of y.value)e.set(t.page_no,t);return e}),T=p(()=>v.value?y.value.findIndex(e=>e.page_no===x.value):-1),O=p(()=>T.value<=0?null:y.value[T.value-1]?.page_no??null),V=p(()=>T.value<0||T.value>=y.value.length-1?null:y.value[T.value+1]?.page_no??null),fe=p(()=>{const e=new Map;for(const t of y.value)t.category_id!==null&&!e.has(t.category_id)&&e.set(t.category_id,t.page_no);return e}),me=p(()=>{const e=new Map;for(const t of y.value)t.category_id===null||t.category_name===null||e.has(t.category_id)||e.set(t.category_id,{id:t.category_id,name:t.category_name,position:t.page_no});return Array.from(e.values()).sort((t,n)=>t.position-n.position)}),ee=p(()=>[...a.categories.length>0?a.categories:me.value].sort((t,n)=>t.position-n.position)),te=p(()=>ee.value.length>0),ae=p(()=>a.editionsForDate.length>0?a.editionsForDate:a.selectedEdition!==null?[a.selectedEdition]:a.page!==null&&a.editionDate!==null?[{id:a.page.edition_id,name:null,edition_date:a.editionDate}]:[]),ne=p(()=>{const e=Number.parseInt(k.value,10);return Number.isFinite(e)&&e>0?e:null}),ve=p(()=>a.editionDate??g.value);N(()=>a.editionDate,e=>{g.value=e??c()}),N(()=>a.page?.page_no,e=>{$.value=e!==void 0?String(e):""}),N(()=>a.page?.category_id,e=>{w.value=e!=null?String(e):""},{immediate:!0}),N(()=>[a.selectedEdition?.id,a.page?.edition_id],([e,t])=>{if(e!=null){k.value=String(e);return}k.value=t!==void 0?String(t):""},{immediate:!0}),N(()=>a.page?.id,()=>{se(()=>{G(),L()})},{immediate:!0}),N(()=>v.value,()=>{se(()=>{G(),L()})});function he(e){return e.name?.trim()||e.edition_date}function A(e,t,n){const U=n!=null&&n>0?n:null;return U===null?`/epaper/${e}/page/${t}`:`/epaper/${e}/page/${t}?edition=${U}`}function _e(e){return`/epaper/${e}`}function le(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)}function H(e){S.value=e,z!==null&&window.clearTimeout(z),z=window.setTimeout(()=>{S.value="",z=null},4e3)}function R(e){if(!v.value||a.editionDate===null)return;const t=pe.value.get(e);t===void 0||t.page_no===x.value||q.visit(A(a.editionDate,t.page_no,ne.value),{preserveScroll:!0})}async function xe(e){const t=A(e,1);if(typeof window>"u"||typeof window.fetch!="function")return t;try{if((await window.fetch(t,{method:"HEAD",credentials:"same-origin"})).ok)return t}catch{}return _e(e)}async function ye(e){if(e==="")return;if(!le(e)){H("Please select a valid date."),g.value=a.editionDate??c();return}if(a.availableDates.length>0&&!a.availableDates.includes(e)){H(`No published edition found for ${e}.`),g.value=a.editionDate??c();return}const t=await xe(e);q.visit(t,{preserveScroll:!0})}function be(e){if(e===null)return;const t=Number.parseInt(String(e),10);!Number.isFinite(t)||t<=0||R(t)}function we(e){if(e===null)return;w.value=String(e);const t=Number.parseInt(String(e),10);if(!Number.isFinite(t)||t<=0)return;const n=fe.value.get(t);if(n===void 0){H("No pages mapped for this category in this edition.");return}R(n)}function ke(e){if(e===null)return;const t=Number.parseInt(String(e),10);if(!(!Number.isFinite(t)||t<=0)){if(k.value=String(t),g.value===""||!le(g.value)){H("Please select a valid date.");return}q.visit(A(g.value,1,t),{preserveScroll:!0})}}function $e(e){const t=e.target;t!==null&&(g.value=t.value,ye(t.value))}function ze(){const e=E.value;if(e instanceof HTMLInputElement)return e;if(e!==null&&"$el"in e&&(e.$el instanceof HTMLElement||e.$el instanceof SVGElement)){const t=e.$el;if(t instanceof HTMLInputElement)return t;const n=t.querySelector('input[type="date"]');if(n instanceof HTMLInputElement)return n}return null}function ie(){const e=ze();if(e===null)return;const t=e;if(t.showPicker!==void 0){t.showPicker();return}e.focus()}function Me(){m.value=m.value==="strip"?"grid":"strip"}function L(){const e=f.value;if(e===null){D.value=null;return}D.value=Math.max(0,Math.round(e.getBoundingClientRect().height))}function G(){_?.disconnect(),_=null,!(typeof window>"u"||f.value===null||!("ResizeObserver"in window))&&(_=new ResizeObserver(()=>{L()}),_.observe(f.value))}return ce(()=>{G(),L()}),ge(()=>{z!==null&&window.clearTimeout(z),_?.disconnect(),_=null}),(e,t)=>(r(),d(M,null,[o(l(De),{title:s.title},null,8,["title"]),i("div",tt,[i("header",at,[i("div",nt,[s.logoUrl?(r(),d("img",{key:0,src:s.logoUrl,alt:"Newspaper logo",class:"h-10 w-auto object-contain sm:h-12"},null,8,lt)):(r(),d("div",it,[o(l(ue),{class:"size-5 text-slate-700"}),t[2]||(t[2]=i("span",{class:"text-lg font-bold tracking-tight text-slate-900"},"ePaper",-1))]))])]),i("main",ot,[i("div",st,[i("div",rt,[i("div",ut,[i("div",dt,[i("div",ct,[o(l(X),{"model-value":w.value,disabled:!te.value,"onUpdate:modelValue":we},{default:u(()=>[o(l(J),null,{default:u(()=>[o(l(K),{placeholder:"Category"})]),_:1}),o(l(Q),null,{default:u(()=>[(r(!0),d(M,null,I(ee.value,n=>(r(),j(l(W),{key:n.id,value:String(n.id)},{default:u(()=>[B(b(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])]),i("div",gt,[o(l(X),{"model-value":k.value,disabled:ae.value.length===0,"onUpdate:modelValue":ke},{default:u(()=>[o(l(J),null,{default:u(()=>[o(l(K),{placeholder:"Edition Select"})]),_:1}),o(l(Q),null,{default:u(()=>[(r(!0),d(M,null,I(ae.value,n=>(r(),j(l(W),{key:n.id,value:String(n.id)},{default:u(()=>[B(b(he(n)),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])]),i("div",pt,[o(l(X),{"model-value":$.value,disabled:!v.value,"onUpdate:modelValue":be},{default:u(()=>[o(l(J),null,{default:u(()=>[o(l(K),{placeholder:"Page"})]),_:1}),o(l(Q),null,{default:u(()=>[(r(!0),d(M,null,I(y.value,n=>(r(),j(l(W),{key:n.id,value:String(n.page_no)},{default:u(()=>[B(" Page "+b(n.page_no),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])]),o(l(C),{type:"button",variant:"ghost",size:"icon-sm",class:"shrink-0",title:m.value==="strip"?"Switch to grid thumbnails":"Switch to strip thumbnails",onClick:Me},{default:u(()=>[m.value==="strip"?(r(),j(l(Fe),{key:0,class:"size-4"})):(r(),j(l(je),{key:1,class:"size-4"}))]),_:1},8,["title"])]),i("div",{class:"inline-flex w-full cursor-pointer items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 px-3 py-1.5 transition hover:border-slate-300 sm:ml-auto sm:w-auto",onClick:ie},[o(l(Re),{class:"size-4 text-slate-500"}),o(l(Ee),{ref_key:"dateInputRef",ref:E,type:"date",value:g.value,list:"public-viewer-dates",class:"h-auto w-full cursor-pointer border-0 bg-transparent p-0 text-sm shadow-none focus-visible:ring-0 sm:w-[140px]",onChange:$e,onClick:Se(ie,["stop"])},null,8,["value"]),i("datalist",ft,[(r(!0),d(M,null,I(s.availableDates,n=>(r(),d("option",{key:n,value:n},null,8,mt))),128))])])]),te.value?re("",!0):(r(),d("p",vt," No categories available. "))]),v.value&&s.page?(r(),d("div",ht,[o(Ae,{class:"hidden lg:block",pages:y.value,"active-page-no":s.page.page_no,mode:m.value,"rail-height":D.value,onSelect:R},null,8,["pages","active-page-no","mode","rail-height"]),i("section",{ref_key:"viewerSectionRef",ref:f,class:"min-w-0 bg-slate-50 p-2 sm:p-3"},[i("div",_t,[o(et,{page:s.page,"edition-date":ve.value,"selected-edition-id":ne.value,"total-pages":y.value.length,"prev-page-no":O.value,"next-page-no":V.value,onPrevious:t[0]||(t[0]=n=>O.value!==null?R(O.value):null),onNext:t[1]||(t[1]=n=>V.value!==null?R(V.value):null)},null,8,["page","edition-date","selected-edition-id","total-pages","prev-page-no","next-page-no"])])],512)])):(r(),d("div",xt," No published edition found. "))])]),i("footer",yt,[i("div",bt,[i("div",wt,[s.logoUrl?(r(),d("img",{key:0,src:s.logoUrl,alt:"Newspaper logo",class:"mx-auto h-10 w-auto object-contain sm:mx-0 sm:h-12"},null,8,kt)):(r(),d("div",$t,[o(l(ue),{class:"size-4 text-slate-500"}),t[3]||(t[3]=i("span",{class:"text-sm font-semibold text-slate-700"},"ePaper",-1))])),i("p",zt,b(s.settings.footer_copyright),1)]),i("div",Mt,[i("p",null,b(s.settings.footer_editor_info),1),i("p",null,b(s.settings.footer_contact_info),1)])])]),S.value!==""?(r(),d("div",Pt,[o(l(Ie),{variant:"destructive",class:"pointer-events-auto shadow-lg"},{default:u(()=>[o(l(Te),{class:"size-4"}),o(l(Ce),null,{default:u(()=>[B(b(S.value),1)]),_:1})]),_:1})])):re("",!0)])],64))}});export{Ft as _};
