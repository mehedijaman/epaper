import{d as Y,o as r,c,O as de,a as i,G as Z,F as M,L as I,p as f,K as y,A as ce,T as Pe,Q as ge,e as o,f as l,w as d,x as _,z as N,B as se,h as De,j as H,J as B,n as Se,k as re,M as q}from"./app-BIDwooZD.js";import{_ as C}from"./index-C8P2q1AW.js";import{c as P}from"./createLucideIcon-ccUrNrU9.js";import{C as Ne}from"./chevron-right-CAogZLbH.js";import{_ as Ce,a as Ie}from"./index-CR_w27Kk.js";import{_ as Ee}from"./Input.vue_vue_type_script_setup_true_lang-B1SXL9YZ.js";import{a as J,b as K,c as Q,d as W,_ as X}from"./SelectValue.vue_vue_type_script_setup_true_lang-CtmDDGDY.js";import{N as ue}from"./newspaper-BTZbB5ry.js";import{C as Te}from"./circle-alert-D7cxjvWW.js";const Re=P("CalendarDaysIcon",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);const Ue=P("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);const Fe=P("Grid2x2Icon",[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 12h18",key:"1i2n21"}],["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}]]);const He=P("ListIcon",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);const Le=P("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);const je=P("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]);const Be=P("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Oe=["title","onClick"],Ve=["src","alt"],Ae=Y({__name:"ThumbnailRail",props:{pages:{},activePageNo:{},mode:{default:"strip"},railHeight:{default:null}},emits:["select"],setup(s,{emit:a}){const g=s,p=a,k=f(()=>g.mode==="grid"?"grid grid-cols-2 gap-2":"flex flex-col gap-2"),b=f(()=>g.railHeight===null||g.railHeight<=0?{}:{height:`${g.railHeight}px`});function w(v){p("select",v)}return(v,E)=>(r(),c("aside",{class:"h-full min-h-0 overflow-y-auto border-r border-slate-200 bg-slate-50 p-2",style:de(b.value)},[i("div",{class:Z(k.value)},[(r(!0),c(M,null,I(s.pages,m=>(r(),c("button",{key:m.id,type:"button",class:Z(["group w-full overflow-hidden rounded-lg border bg-white p-1 text-left transition-all hover:shadow-md focus-visible:ring-2 focus-visible:ring-sky-400 focus-visible:outline-none",m.page_no===s.activePageNo?"border-sky-500 shadow-sm ring-1 ring-sky-500":"border-slate-200 hover:border-slate-300"]),title:`Go to page ${m.page_no}`,onClick:D=>w(m.page_no)},[i("img",{src:m.image_thumb_url,alt:`Page ${m.page_no}`,loading:"lazy",class:"h-auto w-full rounded"},null,8,Ve),i("p",{class:Z(["mt-1 text-center text-[11px] font-medium",m.page_no===s.activePageNo?"text-sky-700":"text-slate-500 group-hover:text-slate-700"])},y(m.page_no),3)],10,Oe))),128))],2)],4))}}),Ge={class:"flex flex-col rounded-xl border border-slate-200 bg-white shadow-md"},Ze=["src","alt"],qe=["href","aria-label"],Je={class:"flex shrink-0 items-center justify-between gap-2 border-t border-slate-200 bg-white px-3 py-2"},Ke={class:"flex items-center gap-1.5"},Qe={class:"min-w-[4rem] text-center text-sm font-medium text-slate-700 tabular-nums"},We={class:"flex items-center gap-1"},Xe=Y({__name:"ViewerFrame",props:{page:{},editionDate:{},selectedEditionId:{default:null},totalPages:{},prevPageNo:{},nextPageNo:{},enablePanzoom:{type:Boolean,default:!0}},emits:["previous","next"],setup(s,{emit:a}){const g=s,p=a,k=_(null),b=_(null),w=_(null),v=_(null);function E(h){return h.image_large_url||h.image_original_url}function m(h){const x=`/epaper/${g.editionDate}/page/${g.page.page_no}/hotspot/${h.id}`;return g.selectedEditionId===null||g.selectedEditionId<=0?x:`${x}?edition=${g.selectedEditionId}`}function D(h){return h.target_page_no===null?"Hotspot":`Hotspot to page ${h.target_page_no}`}function S(){v.value?.reset()}function $(){v.value?.zoomIn()}function z(){v.value?.zoomOut()}return ce(()=>{!g.enablePanzoom||b.value===null||(v.value=Pe(b.value,{maxScale:6,minScale:1,contain:"outside"}))}),ge(()=>{v.value?.destroy()}),(h,x)=>(r(),c("div",Ge,[i("div",{ref_key:"viewportRef",ref:k,class:"flex items-start justify-center overflow-visible bg-slate-50 p-2 sm:p-3"},[i("div",{ref_key:"stageRef",ref:b,class:"relative mx-auto inline-block w-full touch-none select-none"},[i("img",{ref_key:"imageRef",ref:w,src:E(s.page),alt:`Page ${s.page.page_no}`,draggable:"false",class:"block h-auto w-full object-contain"},null,8,Ze),(r(!0),c(M,null,I(s.page.hotspots,u=>(r(),c("a",{key:u.id,href:m(u),target:"_blank",rel:"noopener noreferrer",class:"hotspot-overlay absolute z-20 block rounded-sm border border-transparent bg-transparent transition-all duration-150 focus-visible:ring-2 focus-visible:ring-sky-400/80 focus-visible:outline-none",style:de({left:`${u.x*100}%`,top:`${u.y*100}%`,width:`${u.w*100}%`,height:`${u.h*100}%`}),"aria-label":D(u)},null,12,qe))),128))],512)],512),i("div",Je,[i("div",Ke,[o(l(C),{variant:"ghost",size:"icon-sm",disabled:s.prevPageNo===null,title:"Previous page",onClick:x[0]||(x[0]=u=>p("previous"))},{default:d(()=>[o(l(Ue),{class:"size-4"})]),_:1},8,["disabled"]),i("span",Qe,y(s.page.page_no)+" / "+y(s.totalPages),1),o(l(C),{variant:"ghost",size:"icon-sm",disabled:s.nextPageNo===null,title:"Next page",onClick:x[1]||(x[1]=u=>p("next"))},{default:d(()=>[o(l(Ne),{class:"size-4"})]),_:1},8,["disabled"])]),i("div",We,[o(l(C),{variant:"ghost",size:"icon-sm",title:"Zoom out",onClick:z},{default:d(()=>[o(l(je),{class:"size-4"})]),_:1}),o(l(C),{variant:"ghost",size:"icon-sm",title:"Zoom in",onClick:$},{default:d(()=>[o(l(Be),{class:"size-4"})]),_:1}),o(l(C),{variant:"ghost",size:"icon-sm",title:"Reset zoom",onClick:S},{default:d(()=>[o(l(Le),{class:"size-4"})]),_:1})])])]))}}),Ye=(s,a)=>{const g=s.__vccOpts||s;for(const[p,k]of a)g[p]=k;return g},et=Ye(Xe,[["__scopeId","data-v-1cca8485"]]),tt={class:"flex min-h-screen flex-col bg-slate-100 text-slate-900"},at={class:"border-b border-slate-200 bg-white shadow-sm"},nt={class:"mx-auto flex max-w-7xl items-center justify-center px-4 py-3"},lt=["src"],it={key:1,class:"inline-flex items-center gap-2"},ot={class:"mx-auto w-full max-w-7xl flex-1 px-2 py-3 sm:px-4"},st={class:"rounded-xl border border-slate-200 bg-white shadow-sm"},rt={class:"sticky top-0 z-30 border-b border-slate-200 bg-white/95 px-3 py-2.5 backdrop-blur-sm"},ut={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},dt={class:"flex w-full flex-wrap items-center gap-2 sm:w-auto"},ct={class:"min-w-[140px] flex-1 basis-[160px] sm:w-[170px] sm:flex-none"},gt={class:"min-w-[160px] flex-1 basis-[180px] sm:w-[220px] sm:flex-none"},pt={class:"min-w-[100px] flex-1 basis-[110px] sm:w-[110px] sm:flex-none"},ft={id:"public-viewer-dates"},mt=["value"],vt={key:0,class:"mt-1.5 text-xs text-slate-500"},ht={key:0,class:"grid items-stretch lg:grid-cols-[140px_minmax(0,1fr)]"},_t={class:"mx-auto max-w-5xl"},xt={key:1,class:"flex items-center justify-center p-12 text-sm text-slate-500"},yt={class:"border-t border-slate-200 bg-white py-4"},bt={class:"mx-auto flex max-w-7xl flex-col gap-4 px-4 text-xs text-slate-600 sm:flex-row sm:items-end sm:justify-between sm:text-sm"},wt={class:"space-y-2 text-center sm:text-left"},kt=["src"],$t={key:1,class:"inline-flex items-center gap-2"},zt={class:"text-slate-500"},Mt={class:"max-w-lg space-y-1 text-center text-slate-500 sm:text-right"},Pt={key:0,class:"pointer-events-none fixed top-4 right-4 z-50 w-full max-w-sm"},Ft=Y({__name:"PublicViewerShell",props:{title:{},editionDate:{},page:{},pages:{},categories:{default:()=>[]},editionsForDate:{default:()=>[]},selectedEdition:{default:null},availableDates:{},logoUrl:{default:null},settings:{},adsBySlot:{default:void 0}},setup(s){const a=s;function g(e=new Date){const t=new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(e),n=t.find(F=>F.type==="year")?.value??"",U=t.find(F=>F.type==="month")?.value??"",oe=t.find(F=>F.type==="day")?.value??"";return n!==""&&U!==""&&oe!==""?`${n}-${U}-${oe}`:""}const p=_(g()),k=_(a.page?String(a.page.page_no):""),b=_(""),w=_(""),v=_("strip"),E=_(null),m=_(null),D=_(null),S=_("");let $=null,z=null;const h=f(()=>a.editionDate!==null&&a.page!==null&&u.value.length>0),x=f(()=>a.page?.page_no??0),u=f(()=>{if(a.page===null)return[...a.pages].sort((t,n)=>t.page_no-n.page_no);const e=a.pages.filter(t=>t.edition_id===a.page?.edition_id);return e.length===0?[{id:a.page.id,edition_id:a.page.edition_id,page_no:a.page.page_no,category_id:a.page.category_id,category_name:a.page.category_name,image_thumb_url:a.page.image_thumb_url,image_large_url:a.page.image_large_url,image_original_url:a.page.image_original_url,hotspots:a.page.hotspots}]:e.sort((t,n)=>t.page_no-n.page_no)}),pe=f(()=>{const e=new Map;for(const t of u.value)e.set(t.page_no,t);return e}),T=f(()=>h.value?u.value.findIndex(e=>e.page_no===x.value):-1),O=f(()=>T.value<=0?null:u.value[T.value-1]?.page_no??null),V=f(()=>T.value<0||T.value>=u.value.length-1?null:u.value[T.value+1]?.page_no??null),fe=f(()=>{const e=new Map;for(const t of u.value)t.category_id!==null&&!e.has(t.category_id)&&e.set(t.category_id,t.page_no);return e}),me=f(()=>{const e=new Map;for(const t of u.value)t.category_id===null||t.category_name===null||e.has(t.category_id)||e.set(t.category_id,{id:t.category_id,name:t.category_name,position:t.page_no});return Array.from(e.values()).sort((t,n)=>t.position-n.position)}),ee=f(()=>[...a.categories.length>0?a.categories:me.value].sort((t,n)=>t.position-n.position)),te=f(()=>ee.value.length>0),ae=f(()=>a.editionsForDate.length>0?a.editionsForDate:a.selectedEdition!==null?[a.selectedEdition]:a.page!==null&&a.editionDate!==null?[{id:a.page.edition_id,name:null,edition_date:a.editionDate}]:[]),ne=f(()=>{const e=Number.parseInt(w.value,10);return Number.isFinite(e)&&e>0?e:null}),ve=f(()=>a.editionDate??p.value);N(()=>a.editionDate,e=>{p.value=e??g()}),N(()=>a.page?.page_no,e=>{k.value=e!==void 0?String(e):""}),N(()=>a.page?.category_id,e=>{b.value=e!=null?String(e):""},{immediate:!0}),N(()=>[a.selectedEdition?.id,a.page?.edition_id],([e,t])=>{if(e!=null){w.value=String(e);return}w.value=t!==void 0?String(t):""},{immediate:!0}),N(()=>a.page?.id,()=>{se(()=>{G(),j()})},{immediate:!0}),N(()=>h.value,()=>{se(()=>{G(),j()})});function he(e){return e.name?.trim()||e.edition_date}function A(e,t,n){const U=n!=null&&n>0?n:null;return U===null?`/epaper/${e}/page/${t}`:`/epaper/${e}/page/${t}?edition=${U}`}function _e(e){return`/epaper/${e}`}function le(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)}function L(e){S.value=e,$!==null&&window.clearTimeout($),$=window.setTimeout(()=>{S.value="",$=null},4e3)}function R(e){if(!h.value||a.editionDate===null)return;const t=pe.value.get(e);t===void 0||t.page_no===x.value||q.visit(A(a.editionDate,t.page_no,ne.value),{preserveScroll:!0})}async function xe(e){const t=A(e,1);if(typeof window>"u"||typeof window.fetch!="function")return t;try{if((await window.fetch(t,{method:"HEAD",credentials:"same-origin"})).ok)return t}catch{}return _e(e)}async function ye(e){if(e==="")return;if(!le(e)){L("Please select a valid date."),p.value=a.editionDate??g();return}if(a.availableDates.length>0&&!a.availableDates.includes(e)){L(`No published edition found for ${e}.`),p.value=a.editionDate??g();return}const t=await xe(e);q.visit(t,{preserveScroll:!0})}function be(e){if(e===null)return;const t=Number.parseInt(String(e),10);!Number.isFinite(t)||t<=0||R(t)}function we(e){if(e===null)return;b.value=String(e);const t=Number.parseInt(String(e),10);if(!Number.isFinite(t)||t<=0)return;const n=fe.value.get(t);if(n===void 0){L("No pages mapped for this category in this edition.");return}R(n)}function ke(e){if(e===null)return;const t=Number.parseInt(String(e),10);if(!(!Number.isFinite(t)||t<=0)){if(w.value=String(t),p.value===""||!le(p.value)){L("Please select a valid date.");return}q.visit(A(p.value,1,t),{preserveScroll:!0})}}function $e(e){const t=e.target;t!==null&&(p.value=t.value,ye(t.value))}function ze(){const e=E.value;if(e instanceof HTMLInputElement)return e;if(e!==null&&"$el"in e&&(e.$el instanceof HTMLElement||e.$el instanceof SVGElement)){const t=e.$el;if(t instanceof HTMLInputElement)return t;const n=t.querySelector('input[type="date"]');if(n instanceof HTMLInputElement)return n}return null}function ie(){const e=ze();if(e===null)return;const t=e;if(t.showPicker!==void 0){t.showPicker();return}e.focus()}function Me(){v.value=v.value==="strip"?"grid":"strip"}function j(){const e=m.value;if(e===null){D.value=null;return}D.value=Math.max(0,Math.round(e.getBoundingClientRect().height))}function G(){z?.disconnect(),z=null,!(typeof window>"u"||m.value===null||!("ResizeObserver"in window))&&(z=new ResizeObserver(()=>{j()}),z.observe(m.value))}return ce(()=>{G(),j()}),ge(()=>{$!==null&&window.clearTimeout($),z?.disconnect(),z=null}),(e,t)=>(r(),c(M,null,[o(l(De),{title:s.title},null,8,["title"]),i("div",tt,[i("header",at,[i("div",nt,[s.logoUrl?(r(),c("img",{key:0,src:s.logoUrl,alt:"Newspaper logo",class:"h-10 w-auto object-contain sm:h-12"},null,8,lt)):(r(),c("div",it,[o(l(ue),{class:"size-5 text-slate-700"}),t[2]||(t[2]=i("span",{class:"text-lg font-bold tracking-tight text-slate-900"},"ePaper",-1))]))])]),i("main",ot,[i("div",st,[i("div",rt,[i("div",ut,[i("div",dt,[i("div",ct,[o(l(X),{"model-value":b.value,disabled:!te.value,"onUpdate:modelValue":we},{default:d(()=>[o(l(J),null,{default:d(()=>[o(l(K),{placeholder:"Category"})]),_:1}),o(l(Q),null,{default:d(()=>[(r(!0),c(M,null,I(ee.value,n=>(r(),H(l(W),{key:n.id,value:String(n.id)},{default:d(()=>[B(y(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])]),i("div",gt,[o(l(X),{"model-value":w.value,disabled:ae.value.length===0,"onUpdate:modelValue":ke},{default:d(()=>[o(l(J),null,{default:d(()=>[o(l(K),{placeholder:"Edition Select"})]),_:1}),o(l(Q),null,{default:d(()=>[(r(!0),c(M,null,I(ae.value,n=>(r(),H(l(W),{key:n.id,value:String(n.id)},{default:d(()=>[B(y(he(n)),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])]),i("div",pt,[o(l(X),{"model-value":k.value,disabled:!h.value,"onUpdate:modelValue":be},{default:d(()=>[o(l(J),null,{default:d(()=>[o(l(K),{placeholder:"Page"})]),_:1}),o(l(Q),null,{default:d(()=>[(r(!0),c(M,null,I(u.value,n=>(r(),H(l(W),{key:n.id,value:String(n.page_no)},{default:d(()=>[B(" Page "+y(n.page_no),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","disabled"])]),o(l(C),{type:"button",variant:"ghost",size:"icon-sm",class:"shrink-0",title:v.value==="strip"?"Switch to grid thumbnails":"Switch to strip thumbnails",onClick:Me},{default:d(()=>[v.value==="strip"?(r(),H(l(Fe),{key:0,class:"size-4"})):(r(),H(l(He),{key:1,class:"size-4"}))]),_:1},8,["title"])]),i("div",{class:"inline-flex w-full cursor-pointer items-center gap-2 rounded-lg border border-slate-200 bg-slate-50 px-3 py-1.5 transition hover:border-slate-300 sm:ml-auto sm:w-auto",onClick:ie},[o(l(Re),{class:"size-4 text-slate-500"}),o(l(Ee),{ref_key:"dateInputRef",ref:E,type:"date",value:p.value,list:"public-viewer-dates",class:"h-auto w-full cursor-pointer border-0 bg-transparent p-0 text-sm shadow-none focus-visible:ring-0 sm:w-[140px]",onChange:$e,onClick:Se(ie,["stop"])},null,8,["value"]),i("datalist",ft,[(r(!0),c(M,null,I(s.availableDates,n=>(r(),c("option",{key:n,value:n},null,8,mt))),128))])])]),te.value?re("",!0):(r(),c("p",vt," No categories available. "))]),h.value&&s.page?(r(),c("div",ht,[o(Ae,{class:"hidden lg:block",pages:u.value,"active-page-no":s.page.page_no,mode:v.value,"rail-height":D.value,onSelect:R},null,8,["pages","active-page-no","mode","rail-height"]),i("section",{ref_key:"viewerSectionRef",ref:m,class:"min-w-0 bg-slate-50 p-2 sm:p-3"},[i("div",_t,[o(et,{page:s.page,"edition-date":ve.value,"selected-edition-id":ne.value,"total-pages":u.value.length,"prev-page-no":O.value,"next-page-no":V.value,onPrevious:t[0]||(t[0]=n=>O.value!==null?R(O.value):null),onNext:t[1]||(t[1]=n=>V.value!==null?R(V.value):null)},null,8,["page","edition-date","selected-edition-id","total-pages","prev-page-no","next-page-no"])])],512)])):(r(),c("div",xt," No published edition found. "))])]),i("footer",yt,[i("div",bt,[i("div",wt,[s.logoUrl?(r(),c("img",{key:0,src:s.logoUrl,alt:"Newspaper logo",class:"mx-auto h-10 w-auto object-contain sm:mx-0 sm:h-12"},null,8,kt)):(r(),c("div",$t,[o(l(ue),{class:"size-4 text-slate-500"}),t[3]||(t[3]=i("span",{class:"text-sm font-semibold text-slate-700"},"ePaper",-1))])),i("p",zt,y(s.settings.footer_copyright),1)]),i("div",Mt,[i("p",null,y(s.settings.footer_editor_info),1),i("p",null,y(s.settings.footer_contact_info),1)])])]),S.value!==""?(r(),c("div",Pt,[o(l(Ie),{variant:"destructive",class:"pointer-events-auto shadow-lg"},{default:d(()=>[o(l(Te),{class:"size-4"}),o(l(Ce),null,{default:d(()=>[B(y(S.value),1)]),_:1})]),_:1})])):re("",!0)])],64))}});export{Ft as _};
