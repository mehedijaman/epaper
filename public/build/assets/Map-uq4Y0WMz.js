import{d as Zn,x as p,I as Xt,z as K,B as it,A as el,Q as tl,o as f,c as _,e as a,f as l,h as nl,w as s,a as i,j as J,K as d,J as r,k as C,F as le,L as _e,O as ae,n as y,G as N,l as qt,p as c,M as Be}from"./app-pbFrJQ1g.js";import{_ as st}from"./ConfirmActionDialog.vue_vue_type_script_setup_true_lang-8xFaini9.js";import{_ as ll,P as al,T as ol}from"./EditionContextBar.vue_vue_type_script_setup_true_lang-9L8rp0Zg.js";import{_ as je}from"./InputError.vue_vue_type_script_setup_true_lang-C-HT8cHr.js";import{_ as G}from"./index-Baww2-Ur.js";import{_ as g}from"./index-C7XH55Ot.js";import{_ as Kt,a as il,b as sl,c as Jt}from"./CardTitle.vue_vue_type_script_setup_true_lang-BviJR3X9.js";import{_ as ul,a as rl,b as dl,c as cl,d as vl}from"./DialogTitle.vue_vue_type_script_setup_true_lang-g7g98qn6.js";import{_ as fl}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BzOfP_qh.js";import{_ as Gt}from"./Input.vue_vue_type_script_setup_true_lang-usT0mv6o.js";import{_ as Ce,a as Se,b as $e,c as He,d as B}from"./SelectValue.vue_vue_type_script_setup_true_lang-BR1WuhBE.js";import{_ as pl}from"./EpAdminLayout.vue_vue_type_script_setup_true_lang-p4ThBxOh.js";import{c as Qt}from"./createLucideIcon-Dlt7ezm_.js";import"./Primitive-C8vVXU7w.js";import"./useForwardPropsEmits-vmL0mnr1.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-fWq6354L.js";import"./chevron-right-BL-wNo7u.js";import"./VisuallyHidden-Bk48DAoD.js";import"./RovingFocusGroup-Cxwyt7A6.js";import"./newspaper-DOM4mVgu.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BneoCAm3.js";import"./check-DcPSa9Jq.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./useFormControl-Sj2gakQL.js";import"./index-7fT0rfcv.js";import"./AlertTitle.vue_vue_type_script_setup_true_lang-BytXgFv1.js";const gl=Qt("LinkIcon",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const ml=Qt("SaveIcon",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),_l={class:"space-y-4 p-4"},hl={class:"flex flex-wrap items-start justify-between gap-3"},bl={class:"space-y-1"},xl={class:"grid gap-3 lg:grid-cols-[minmax(0,1.4fr)_repeat(3,minmax(0,1fr))]"},wl={class:"space-y-3 rounded-lg border bg-background p-3"},yl={class:"flex items-center justify-between gap-2"},kl={class:"text-xs font-medium text-muted-foreground"},Dl={class:"grid grid-cols-2 gap-2"},Cl={class:"space-y-1 rounded-lg border bg-background p-3"},Sl={class:"text-2xl font-semibold"},$l={class:"text-xs text-muted-foreground"},Hl={class:"space-y-1 rounded-lg border bg-background p-3"},Ml={class:"text-2xl font-semibold"},Tl={class:"text-xs text-muted-foreground"},zl={class:"space-y-1 rounded-lg border bg-background p-3"},Ll={class:"text-2xl font-semibold"},Il={class:"text-xs text-muted-foreground"},El={class:"mt-2 flex flex-wrap gap-2"},Nl={class:"grid items-stretch gap-4 xl:grid-cols-[minmax(0,1fr)_24rem]"},Pl={class:"space-y-3"},Vl={class:"flex flex-wrap items-center justify-between gap-2 rounded-lg border bg-background px-3 py-2 text-xs"},Rl={class:"flex flex-wrap items-center gap-2"},Fl={class:"flex items-center gap-2"},Al={key:0,class:"flex flex-wrap items-center justify-between gap-2 rounded-lg border border-blue-300 bg-blue-50 px-3 py-2 text-xs text-blue-900"},Ol={class:"space-y-1"},Ul={class:"relative w-full"},Bl=["src","alt"],jl=["title","onMouseenter","onMouseleave","onMousedown","onTouchstart"],Wl={key:0,class:"pointer-events-none absolute -top-2 left-0 rounded bg-slate-900/85 px-1 py-0.5 text-[10px] leading-none font-semibold tracking-wide text-white uppercase"},Yl=["onMousedown","onTouchstart"],Xl={key:2,class:"pointer-events-none absolute top-2 right-2 rounded bg-slate-900/80 px-2 py-1 text-[11px] font-medium text-white"},ql={class:"flex h-full min-h-0 min-h-[24rem] flex-col overflow-hidden rounded-xl border bg-background"},Kl={class:"flex flex-wrap items-center justify-between gap-2 border-b px-4 py-3"},Jl={class:"text-xs text-muted-foreground"},Gl={class:"flex flex-col gap-3 border-b p-3"},Ql={class:"space-y-2"},Zl={class:"flex flex-wrap gap-2"},ea={class:"flex flex-wrap gap-2"},ta={class:"space-y-2 rounded-lg border bg-muted/20 p-2"},na={class:"flex flex-wrap items-center justify-between gap-2 text-xs text-muted-foreground"},la={class:"flex flex-wrap gap-2"},aa={class:"flex-1 space-y-3 overflow-y-auto p-3"},oa=["onMouseenter","onMouseleave","onFocus","onBlur","onClick","onKeydown"],ia={class:"flex items-start gap-3"},sa=["checked","onChange"],ua={class:"sr-only"},ra={class:"relative h-16 w-24 shrink-0 overflow-hidden rounded-md border bg-muted/30"},da=["src"],ca={key:1,class:"flex h-full w-full items-center justify-center text-[10px] text-muted-foreground"},va={class:"min-w-0 flex-1 space-y-2 text-sm"},fa={class:"flex flex-wrap items-center justify-between gap-2"},pa={class:"font-medium"},ga={class:"text-muted-foreground"},ma={key:0,class:"text-muted-foreground"},_a={key:0},ha={key:1,class:"truncate text-muted-foreground"},ba={key:0,class:"text-sm text-muted-foreground"},xa={key:1,class:"text-sm text-muted-foreground"},wa={key:0,class:"text-xs text-amber-700"},ya={class:"space-y-4"},ka={class:"space-y-3 rounded-lg border bg-muted/20 p-3"},Da={class:"grid gap-3 md:grid-cols-2"},Ca={class:"space-y-2"},Sa={class:"space-y-2"},$a={class:"space-y-2"},Ha={key:0},Ma={class:"text-muted-foreground"},Ta={class:"space-y-3 rounded-lg border p-3"},za={class:"space-y-2"},La={key:0,class:"flex flex-wrap items-center justify-between gap-2 rounded-md border bg-muted/20 p-2"},oo=Zn({__name:"Map",props:{selected_page_id:{},edition:{},page:{},edition_pages:{},target_page_numbers:{},target_hotspots_by_page:{},focus_hotspot_id:{}},setup(Zt){const v=Zt,en=[{title:"Page Mapping",href:"/admin/hotspots"}],ut=p(null),We=p(null),k=p({width:0,height:0}),Me=p({width:0,height:0}),oe=p(v.selected_page_id!==null?String(v.selected_page_id):""),T=p(!1),L=p(null),D=p(null),Q=p(!1),$=p(null),Ye=p(v.focus_hotspot_id),te=p(""),S=p(null),z=p(!0),P=p("all"),ne=p("id_asc"),Xe=new Map,h=p(null),ie=p(!1),V=p(null),I=p([]),se=p(!1),j=p("manual"),ue=p(!1),Te=p(null),re=p(null),H=p(null),he=p(null),be=p(null),W=p(null),b=p(null),xe=p(null),u=Xt({page_id:0,relation_kind:"next",target_page_no:1,target_hotspot_id:null,x:0,y:0,w:0,h:0,label:""}),de=Xt({page_id:0,hotspot_ids:[]}),x=c(()=>v.page),w=c(()=>x.value?.hotspots??[]),tn=c(()=>x.value?.page_no??1),qe=c(()=>x.value!==null),nn=["nw","n","ne","e","se","s","sw","w"],rt=c(()=>v.target_page_numbers.length>0?v.target_page_numbers:x.value!==null?[x.value.page_no]:[]),Ke=c(()=>{const e=new Map;for(const[t,n]of Object.entries(v.target_hotspots_by_page)){const o=Number.parseInt(t,10);Number.isFinite(o)&&e.set(o,n.map(m=>({id:m.id,relation_kind:m.relation_kind,target_page_no:m.target_page_no,label:m.label})))}return e}),dt=c(()=>{const e=Ke.value.get(u.target_page_no)??[];return $.value===null?e:e.filter(t=>t.id!==$.value)}),ct=c({get:()=>u.target_hotspot_id===null?"__none":String(u.target_hotspot_id),set:e=>{if(e==="__none"){u.target_hotspot_id=null;return}const t=Number.parseInt(e,10);u.target_hotspot_id=Number.isFinite(t)?t:null}}),vt=c(()=>({width:`${k.value.width}px`,height:`${k.value.height}px`})),ze=c(()=>{if(x.value===null)return"";const e=x.value.image_large_url;return typeof e=="string"&&e.trim()!==""?e:x.value.image_original_url}),ln=c(()=>$.value===null?"Create hotspot":"Edit hotspot"),an=c(()=>$.value===null?"Save hotspot":"Update hotspot"),on=c(()=>D.value!==null),ft=c(()=>{const e=[...w.value];return ne.value==="id_desc"?e.sort((t,n)=>n.id-t.id):ne.value==="target_page"?e.sort((t,n)=>t.target_page_no===n.target_page_no?t.id-n.id:t.target_page_no-n.target_page_no):ne.value==="relation"?e.sort((t,n)=>t.relation_kind===n.relation_kind?t.id-n.id:t.relation_kind.localeCompare(n.relation_kind)):e.sort((t,n)=>t.id-n.id)}),pt=c(()=>P.value==="all"?ft.value:ft.value.filter(e=>F(e)===P.value)),Y=c(()=>{const e=te.value.trim().toLowerCase();return e===""?pt.value:pt.value.filter(t=>{const n=t.label?.toLowerCase()??"",o=ye(t);return String(t.id).includes(e)||t.relation_kind.toLowerCase().includes(e)||String(t.target_page_no).includes(e)||o!==null&&String(o).includes(e)||n.includes(e)||Oe(F(t)).toLowerCase().includes(e)})}),Le=c(()=>new Set(I.value)),we=c(()=>I.value.length),gt=c(()=>Y.value.reduce((e,t)=>Le.value.has(t.id)?e+1:e,0)),Ie=c(()=>we.value>0),mt=c(()=>Y.value.length>0&&gt.value===Y.value.length),Ee=c(()=>!Q.value||Te.value===null?!1:Te.value!==$t()),sn=c(()=>Ee.value||D.value!==null||b.value!==null),Ne=c(()=>w.value.filter(e=>F(e)==="mismatch").map(e=>e.id)),Pe=c(()=>w.value.filter(e=>F(e)==="none").map(e=>e.id)),un=c(()=>j.value==="mismatch"?"Delete mismatch hotspots?":j.value==="unlinked"?"Delete unlinked hotspots?":"Delete selected hotspots?"),rn=c(()=>j.value==="mismatch"?"Delete mismatches":j.value==="unlinked"?"Delete unlinked":"Delete selected"),dn=c(()=>j.value==="mismatch"?`Delete ${we.value} mismatch hotspot(s)? Linked references will be detached where needed. This action cannot be undone.`:j.value==="unlinked"?`Delete ${we.value} unlinked hotspot(s)? This action cannot be undone.`:`Delete ${we.value} selected hotspot(s)? Linked references will be detached where needed. This action cannot be undone.`),R=c(()=>{const e={paired:0,outbound:0,inbound:0,mismatch:0,none:0};for(const t of w.value){const n=F(t);e[n]+=1}return e}),Ve=c(()=>v.edition_pages.findIndex(e=>String(e.id)===oe.value)),_t=c(()=>Ve.value>0),ht=c(()=>Ve.value>=0&&Ve.value<v.edition_pages.length-1),cn=c(()=>v.edition!==null&&typeof v.edition.name=="string"&&v.edition.name.trim()!==""?v.edition.name.trim():v.edition!==null?`Edition ${v.edition.id}`:"Edition"),vn=c(()=>{if(v.edition!==null)return`/admin/editions/manage?date=${v.edition.edition_date}&edition_id=${v.edition.id}`}),fn=c(()=>{if(v.edition!==null)return`/admin/editions/publish?date=${v.edition.edition_date}&edition_id=${v.edition.id}`}),pn=c(()=>oe.value===""?"/admin/hotspots":`/admin/hotspots?page_id=${oe.value}`),gn=c(()=>te.value.trim()!==""||P.value!=="all"||ne.value!=="id_asc"),A=c(()=>h.value===null?null:w.value.find(e=>e.id===h.value)??null),Je=c(()=>A.value===null?null:H.value!==null&&W.value!==null?W.value:b.value!==null?b.value:{x:A.value.x,y:A.value.y,w:A.value.w,h:A.value.h});K(()=>v.selected_page_id,e=>{oe.value=e!==null?String(e):"",D.value=null,b.value=null,W.value=null,T.value=!1,L.value=null,h.value=null,X(),I.value=[],se.value=!1,ue.value=!1,re.value=null,it(()=>{window.requestAnimationFrame(ce)})}),K(()=>ze.value,()=>{it(()=>{window.requestAnimationFrame(ce)})}),K(()=>v.focus_hotspot_id,e=>{Ye.value=e,Tt()},{immediate:!0}),K(()=>u.target_page_no,()=>{if(u.target_hotspot_id===null)return;dt.value.some(t=>t.id===u.target_hotspot_id)||(u.target_hotspot_id=null)}),K(w,()=>{Tt();const e=new Set(w.value.map(n=>n.id)),t=I.value.filter(n=>e.has(n));t.length!==I.value.length&&(I.value=t),t.length===0&&(se.value=!1),h.value!==null&&!w.value.some(n=>n.id===h.value)&&(h.value=null,X(),D.value=null,b.value=null,W.value=null)}),K($,e=>{S.value=e}),K(S,async e=>{e!==null&&(await it(),Xe.get(e)?.scrollIntoView({behavior:"smooth",block:"nearest"}))}),el(()=>{window.addEventListener("resize",ce),window.addEventListener("keydown",Wt),window.addEventListener("mousemove",xt),window.addEventListener("mouseup",wt),window.addEventListener("beforeunload",Yt),ce()}),tl(()=>{window.removeEventListener("resize",ce),window.removeEventListener("keydown",Wt),window.removeEventListener("mousemove",xt),window.removeEventListener("mouseup",wt),window.removeEventListener("beforeunload",Yt)});function E(e,t=0,n=1){return Math.min(Math.max(e,t),n)}function ce(){const e=We.value;if(e===null){k.value={width:0,height:0},Me.value={width:0,height:0};return}const t=e.getBoundingClientRect();k.value={width:Math.max(0,t.width),height:Math.max(0,t.height)},Me.value={width:Math.max(0,e.naturalWidth),height:Math.max(0,e.naturalHeight)}}function Re(e,t){const n=We.value;if(n===null)return null;const o=n.getBoundingClientRect();return o.width<=0||o.height<=0?null:{x:E((e-o.left)/o.width),y:E((t-o.top)/o.height)}}function bt(e,t){if(!qe.value||!z.value)return;const n=Re(e,t);n!==null&&(T.value=!0,L.value=n,D.value={x:n.x,y:n.y,w:0,h:0})}function Ge(e,t){if(!T.value||L.value===null)return;const n=Re(e,t);if(n===null)return;const o=Math.min(L.value.x,n.x),m=Math.min(L.value.y,n.y),M=Math.abs(n.x-L.value.x),O=Math.abs(n.y-L.value.y);D.value={x:E(o),y:E(m),w:E(M),h:E(O)}}function Qe(){if(!T.value||(T.value=!1,L.value=null,D.value===null))return;if(D.value.w<=.005||D.value.h<=.005){D.value=null;return}const e=D.value;if(h.value!==null){const t=w.value.find(n=>n.id===h.value);h.value=null,t!==void 0&&(Z(t),u.x=e.x,u.y=e.y,u.w=e.w,u.h=e.h),D.value=null;return}In(e),D.value=null}function Fe(e){const t=e.touches[0]??e.changedTouches[0];return t===void 0?null:{x:t.clientX,y:t.clientY}}function mn(e){e.button===0&&(e.preventDefault(),bt(e.clientX,e.clientY))}function _n(e){if(H.value!==null){e.preventDefault(),et(e.clientX,e.clientY);return}T.value&&(e.preventDefault(),Ge(e.clientX,e.clientY))}function hn(e){if(H.value!==null&&e.button===0){e.preventDefault(),tt();return}T.value&&(e.preventDefault(),Qe())}function xt(e){if(H.value!==null){et(e.clientX,e.clientY);return}T.value&&Ge(e.clientX,e.clientY)}function wt(e){if(H.value!==null&&e.button===0){tt();return}!T.value||e.button!==0||Qe()}function bn(e){const t=Fe(e);t!==null&&bt(t.x,t.y)}function xn(e){const t=Fe(e);if(t!==null){if(H.value!==null){et(t.x,t.y);return}Ge(t.x,t.y)}}function yt(){if(H.value!==null){tt();return}Qe()}function Ze(e){return{left:`${e.x*k.value.width}px`,top:`${e.y*k.value.height}px`,width:`${e.w*k.value.width}px`,height:`${e.h*k.value.height}px`}}function X(){H.value=null,he.value=null,be.value=null,W.value=null}function wn(e){return e==="n"||e==="s"?"cursor-ns-resize":e==="e"||e==="w"?"cursor-ew-resize":e==="nw"||e==="se"?"cursor-nwse-resize":"cursor-nesw-resize"}function yn(e){return e==="n"?{top:"-6px",left:"50%",transform:"translate(-50%, -50%)"}:e==="s"?{bottom:"-6px",left:"50%",transform:"translate(-50%, 50%)"}:e==="e"?{top:"50%",right:"-6px",transform:"translate(50%, -50%)"}:e==="w"?{top:"50%",left:"-6px",transform:"translate(-50%, -50%)"}:e==="nw"?{top:"-6px",left:"-6px",transform:"translate(-50%, -50%)"}:e==="ne"?{top:"-6px",right:"-6px",transform:"translate(50%, -50%)"}:e==="sw"?{bottom:"-6px",left:"-6px",transform:"translate(-50%, 50%)"}:{bottom:"-6px",right:"-6px",transform:"translate(50%, 50%)"}}function Ae(e,t,n){const o=Je.value;if(o===null)return;const m=Re(t,n);m!==null&&(H.value=e,he.value=m,be.value={x:o.x,y:o.y,w:o.w,h:o.h},W.value={x:o.x,y:o.y,w:o.w,h:o.h})}function kt(e,t){t.button===0&&(t.preventDefault(),Ae(e,t.clientX,t.clientY))}function Dt(e,t){const n=Fe(t);n!==null&&(t.preventDefault(),Ae(e,n.x,n.y))}function kn(e,t){t.button===0&&(t.preventDefault(),z.value||(z.value=!0),h.value!==e.id&&ke(e),Ae("move",t.clientX,t.clientY))}function Dn(e,t){const n=Fe(t);n!==null&&(t.preventDefault(),z.value||(z.value=!0),h.value!==e.id&&ke(e),Ae("move",n.x,n.y))}function et(e,t){if(H.value===null||he.value===null||be.value===null)return;const n=Re(e,t);if(n===null)return;const o=be.value,m=H.value,M=n.x-he.value.x,O=n.y-he.value.y,q=.005;if(m==="move"){const at=E(o.x+M,0,Math.max(0,1-o.w)),ot=E(o.y+O,0,Math.max(0,1-o.h));W.value={x:at,y:ot,w:o.w,h:o.h};return}let ee=o.x,U=o.y,ge=o.x+o.w,me=o.y+o.h;m.includes("w")&&(ee=E(ee+M,0,ge-q)),m.includes("e")&&(ge=E(ge+M,ee+q,1)),m.includes("n")&&(U=E(U+O,0,me-q)),m.includes("s")&&(me=E(me+O,U+q,1)),W.value={x:ee,y:U,w:ge-ee,h:me-U}}function tt(){if(H.value===null)return;const e=be.value,t=W.value;X(),!(e===null||t===null||!(Math.abs(t.x-e.x)>1e-6||Math.abs(t.y-e.y)>1e-6||Math.abs(t.w-e.w)>1e-6||Math.abs(t.h-e.h)>1e-6))&&(b.value={x:t.x,y:t.y,w:t.w,h:t.h})}function Cn(e){const t=Me.value.width,n=Me.value.height;if(t<=0||n<=0)return{};const o=96,m=64,M=Math.max(e.w,1e-6),O=Math.max(e.h,1e-6),q=M*t,ee=O*n;if(q<=0||ee<=0)return{};const U=Math.min(o/q,m/ee),ge=t*U,me=n*U,at=(e.x+M/2)*t*U,ot=(e.y+O/2)*n*U,Gn=o/2-at,Qn=m/2-ot;return{width:`${ge}px`,height:`${me}px`,left:`${Gn}px`,top:`${Qn}px`,maxWidth:"none"}}function Sn(){const e=rt.value;return e.find(n=>n!==tn.value)??e[0]??1}function $n(e){for(const[t,n]of Ke.value.entries())if(n.some(m=>m.id===e))return t;return null}function ye(e){return e.target_hotspot_id??e.linked_hotspot_id??null}function Ct(e){for(const[t,n]of Ke.value.entries()){if(!n.some(M=>M.id===e))continue;const m=v.edition_pages.find(M=>M.page_no===t);if(m!==void 0)return{pageNo:t,pageId:m.id}}return null}function St(e){const t=ye(e);return t===null?null:Ct(t)?.pageNo??null}function F(e){const t=e.target_hotspot_id??null,n=e.linked_hotspot_id??null;return t===null&&n===null?"none":t!==null&&n!==null?t===n?"paired":"mismatch":t!==null?"outbound":"inbound"}function Oe(e){return e==="paired"?"Linked":e==="outbound"?"Outbound link":e==="inbound"?"Inbound link":e==="mismatch"?"Link mismatch":"No link"}function Hn(e){return e==="paired"?"default":e==="outbound"||e==="inbound"?"secondary":e==="mismatch"?"destructive":"outline"}function Mn(e){const t=F(e);return t==="paired"?"border-emerald-500 bg-emerald-500/15 hover:bg-emerald-500/25":t==="outbound"?"border-sky-500 bg-sky-500/15 hover:bg-sky-500/25":t==="inbound"?"border-amber-500 bg-amber-500/15 hover:bg-amber-500/25":t==="mismatch"?"border-rose-500 bg-rose-500/15 hover:bg-rose-500/25":"border-slate-400 bg-slate-200/25 hover:bg-slate-200/45"}function Tn(e){return e.y<.04}function zn(e){return e==="paired"?"L":e==="outbound"?"OUT":e==="inbound"?"IN":e==="mismatch"?"ERR":""}function Ln(e){const t=F(e),n=e.target_hotspot_id??e.linked_hotspot_id??null;return n!==null?`Target page ${e.target_page_no} • ${Oe(t)} (#${n})`:`Target page ${e.target_page_no} • ${Oe(t)}`}function Ue(e){return Number.parseFloat(e.toFixed(6))}function $t(){return JSON.stringify({relation_kind:u.relation_kind,target_page_no:u.target_page_no,target_hotspot_id:u.target_hotspot_id,x:Ue(u.x),y:Ue(u.y),w:Ue(u.w),h:Ue(u.h),label:u.label.trim()})}function Ht(){Te.value=$t()}function Mt(){u.page_id=x.value?.id??0,u.relation_kind="next",u.target_page_no=Sn(),u.target_hotspot_id=null,u.x=0,u.y=0,u.w=0,u.h=0,u.label="",u.clearErrors()}function In(e){x.value!==null&&(Mt(),h.value=null,b.value=null,$.value=null,S.value=null,u.x=e.x,u.y=e.y,u.w=e.w,u.h=e.h,Q.value=!0,Ht())}function Z(e){if(x.value===null)return;h.value!==e.id&&(b.value=null),Mt(),h.value=e.id,$.value=e.id,S.value=e.id,u.relation_kind=e.relation_kind,u.target_page_no=e.target_page_no;const t=e.target_hotspot_id??e.linked_hotspot_id??null;if(u.target_hotspot_id=t,t!==null){const n=$n(t);n!==null&&(u.target_page_no=n)}u.x=b.value?.x??e.x,u.y=b.value?.y??e.y,u.w=b.value?.w??e.w,u.h=b.value?.h??e.h,u.label=e.label??"",Q.value=!0,Ht()}function Tt(){const e=Ye.value;if(e===null)return;const t=w.value.find(n=>n.id===e);t!==void 0&&(Z(t),Ye.value=null)}function ve(){Q.value=!1,$.value=null,S.value=null,ue.value=!1,Te.value=null,u.clearErrors()}function zt(){if(!u.processing){if(Ee.value){ue.value=!0;return}ve()}}function En(){const e=re.value;ve(),e!==null&&(re.value=null,D.value=null,b.value=null,T.value=!1,L.value=null,h.value=null,X(),Et(e))}function Nn(e){ue.value=e,e||(re.value=null)}function Pn(e){if(e){Q.value=!0;return}zt()}function Lt(e){const t=ye(e);if(t===null)return;const n=w.value.find(m=>m.id===t);if(n!==void 0){Z(n);return}const o=Ct(t);o!==null&&Be.get("/admin/hotspots",{page_id:o.pageId,focus_hotspot_id:t},{preserveScroll:!0,preserveState:!0,replace:!0})}function Vn(){if(x.value===null)return;u.page_id=x.value.id;const e=u.transform(t=>({...t,target_hotspot_id:t.target_hotspot_id,label:t.label.trim()===""?null:t.label.trim()}));if($.value===null){e.post("/admin/hotspots",{preserveScroll:!0,forceFormData:!1,onSuccess:()=>{b.value=null,ve()}});return}e.put(`/admin/hotspots/${$.value}`,{preserveScroll:!0,forceFormData:!1,onSuccess:()=>{b.value=null,ve()}})}function Rn(e){if(x.value===null||b.value===null||xe.value!==null)return;const t=b.value;xe.value=e.id;const n=e.target_hotspot_id??e.linked_hotspot_id??null;Be.put(`/admin/hotspots/${e.id}`,{page_id:x.value.id,relation_kind:e.relation_kind,target_page_no:e.target_page_no,target_hotspot_id:n,x:t.x,y:t.y,w:t.w,h:t.h,label:e.label??""},{preserveScroll:!0,onSuccess:()=>{b.value=null,xe.value=null},onError:()=>{xe.value=null}})}function It(e){V.value=e,ie.value=!0}function Fn(){if(V.value===null)return;const e=V.value;Be.delete(`/admin/hotspots/${e.id}`,{preserveScroll:!0,onSuccess:()=>{ie.value=!1,V.value=null}})}function An(e){ie.value=e,e||(V.value=null)}K(ie,e=>{e||(V.value=null)}),K(w,e=>{V.value===null||e.some(n=>n.id===V.value?.id)||(V.value=null,ie.value=!1)});function Et(e){oe.value=e;const t=Number.parseInt(e,10);Number.isNaN(t)||t<=0||Be.get("/admin/hotspots",{page_id:t},{preserveScroll:!0,preserveState:!0,replace:!0})}function Nt(e){if(e==null)return;const t=String(e);if(Q.value){if(Ee.value){re.value=t,ue.value=!0;return}ve()}D.value=null,T.value=!1,L.value=null,h.value=null,b.value=null,X(),re.value=null,Et(t)}function Pt(e){const t=Ve.value;if(t<0)return;const n=e==="previous"?t-1:t+1,o=v.edition_pages[n];o!==void 0&&Nt(String(o.id))}function Vt(){Pt("previous")}function Rt(){Pt("next")}function Ft(){z.value=!z.value,z.value||(h.value=null,b.value=null,X(),D.value=null)}function ke(e){h.value=e.id,b.value=null,S.value=e.id,z.value=!0,X(),D.value=null,T.value=!1,L.value=null}function nt(){h.value=null,b.value=null,X(),D.value=null,T.value=!1,L.value=null}function On(){if($.value===null)return;const e=w.value.find(t=>t.id===$.value);e!==void 0&&(ve(),ke(e))}function At(e){const t=ut.value;if(t===null||k.value.width<=0||k.value.height<=0)return;const n=e.x*k.value.width,o=e.y*k.value.height,m=e.w*k.value.width,M=e.h*k.value.height,O=Math.max(0,n+m/2-t.clientWidth/2),q=Math.max(0,o+M/2-t.clientHeight/2);t.scrollTo({left:O,top:q,behavior:"smooth"})}function fe(e){P.value=e}function pe(e){return e==="all"?w.value.length:R.value[e]}function Ot(e){S.value=e}function lt(e){$.value!==e&&(S.value=null)}function Un(e,t){if(t instanceof HTMLElement){Xe.set(e,t);return}Xe.delete(e)}function Bn(){te.value="",P.value="all",ne.value="id_asc"}function jn(e){const t=new Set(I.value);t.has(e)?t.delete(e):t.add(e),I.value=[...t].sort((n,o)=>n-o)}function De(e){const t=[...new Set(e)].filter(n=>Number.isInteger(n)&&n>0).sort((n,o)=>n-o);I.value=t}function Ut(){De([])}function Wn(){De(Ne.value)}function Yn(){De(Pe.value)}function Bt(e){e==="mismatch"?De(Ne.value):e==="unlinked"&&De(Pe.value),jt(e)}function Xn(){const e=Y.value.map(n=>n.id);if(e.length===0)return;const t=new Set(I.value);if(mt.value)for(const n of e)t.delete(n);else for(const n of e)t.add(n);I.value=[...t].sort((n,o)=>n-o)}function jt(e="manual"){!Ie.value||x.value===null||de.processing||(j.value=e,se.value=!0)}function qn(){!Ie.value||x.value===null||(de.page_id=x.value.id,de.hotspot_ids=[...I.value],de.post("/admin/hotspots/bulk-delete",{preserveScroll:!0,forceFormData:!1,onSuccess:()=>{se.value=!1,j.value="manual",Ut()}}))}function Kn(e){se.value=e,e||(j.value="manual")}function Jn(e){if(!(e instanceof HTMLElement))return!1;const t=e.tagName.toLowerCase();return t==="input"||t==="textarea"||e.isContentEditable}function Wt(e){if(!(Q.value||!qe.value||Jn(e.target))){if(e.key==="Escape"&&H.value!==null){e.preventDefault(),X();return}if(e.key==="Escape"&&h.value!==null){e.preventDefault(),nt();return}if(e.key.toLowerCase()==="d"){e.preventDefault(),Ft();return}if(e.key.toLowerCase()==="e"&&S.value!==null){const t=w.value.find(n=>n.id===S.value);if(t!==void 0){e.preventDefault(),ke(t);return}}if(e.key.toLowerCase()==="f"&&S.value!==null){const t=w.value.find(n=>n.id===S.value);if(t!==void 0){e.preventDefault(),At(t);return}}e.key==="ArrowLeft"&&_t.value&&(e.preventDefault(),Vt()),e.key==="ArrowRight"&&ht.value&&(e.preventDefault(),Rt())}}function Yt(e){sn.value&&(e.preventDefault(),e.returnValue="")}return(e,t)=>(f(),_(le,null,[a(l(nl),{title:"Page Hotspots"}),a(pl,{breadcrumbs:en},{default:s(()=>[i("div",_l,[t[63]||(t[63]=i("div",{class:"space-y-1"},[i("h1",{class:"text-xl font-semibold"},"Mapping Editor"),i("p",{class:"text-sm text-muted-foreground"}," Draw rectangles over a page and connect them to another page or a specific hotspot. ")],-1)),qe.value?(f(),J(l(Kt),{key:0,class:"overflow-hidden"},{default:s(()=>[a(l(il),{class:"space-y-3 border-b bg-muted/20"},{default:s(()=>[i("div",hl,[i("div",bl,[a(l(sl),{class:"flex flex-wrap items-center gap-2"},{default:s(()=>[i("span",null,d(cn.value),1),a(l(G),{variant:"outline"},{default:s(()=>[r(d(v.edition?.edition_date),1)]),_:1}),a(l(G),{variant:v.edition?.status==="published"?"default":"secondary"},{default:s(()=>[r(d(v.edition?.status),1)]),_:1},8,["variant"])]),_:1}),t[21]||(t[21]=i("p",{class:"text-sm text-muted-foreground"}," Draw a rectangle to create a hotspot, then connect it to a page or a specific linked hotspot. ",-1))]),a(l(G),{variant:"outline"},{default:s(()=>[r("Page "+d(x.value?.page_no),1)]),_:1})])]),_:1}),a(l(Jt),{class:"space-y-4 p-4"},{default:s(()=>[v.edition?(f(),J(ll,{key:0,"edition-id":v.edition.id,"edition-date":v.edition.edition_date,"edition-name":v.edition.name,status:v.edition.status,"pages-count":v.edition.pages_count,"published-at":v.edition.published_at,"current-page-no":x.value?.page_no??null,"manage-href":vn.value,"publish-href":fn.value,"mapping-href":pn.value},null,8,["edition-id","edition-date","edition-name","status","pages-count","published-at","current-page-no","manage-href","publish-href","mapping-href"])):C("",!0),i("div",xl,[i("div",wl,[i("div",yl,[t[22]||(t[22]=i("p",{class:"text-xs tracking-wide text-muted-foreground uppercase"}," Selected page ",-1)),i("p",kl," Page "+d(x.value?.page_no),1)]),a(l(Ce),{"model-value":oe.value,"onUpdate:modelValue":Nt},{default:s(()=>[a(l(Se),null,{default:s(()=>[a(l($e),{placeholder:"Select page"})]),_:1}),a(l(He),null,{default:s(()=>[(f(!0),_(le,null,_e(v.edition_pages,n=>(f(),J(l(B),{key:n.id,value:String(n.id)},{default:s(()=>[r(" Page "+d(n.page_no),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"]),i("div",Dl,[a(l(g),{size:"sm",variant:"outline",disabled:!_t.value,onClick:Vt},{default:s(()=>[...t[23]||(t[23]=[r(" Previous page ",-1)])]),_:1},8,["disabled"]),a(l(g),{size:"sm",variant:"outline",disabled:!ht.value,onClick:Rt},{default:s(()=>[...t[24]||(t[24]=[r(" Next page ",-1)])]),_:1},8,["disabled"])])]),i("div",Cl,[t[25]||(t[25]=i("p",{class:"text-xs tracking-wide text-muted-foreground uppercase"}," Total pages ",-1)),i("p",Sl,d(v.edition?.pages_count??0),1),i("p",$l," Max page "+d(v.edition?.max_page_no??0),1)]),i("div",Hl,[t[26]||(t[26]=i("p",{class:"text-xs tracking-wide text-muted-foreground uppercase"}," Hotspots on this page ",-1)),i("p",Ml,d(w.value.length),1),i("p",Tl," Linked: "+d(R.value.paired),1)]),i("div",zl,[t[31]||(t[31]=i("p",{class:"text-xs tracking-wide text-muted-foreground uppercase"}," Needs attention ",-1)),i("p",Ll,d(R.value.mismatch),1),i("p",Il," Outbound "+d(R.value.outbound)+" • Inbound "+d(R.value.inbound)+" • Unlinked "+d(R.value.none),1),i("div",El,[a(l(g),{size:"sm",variant:"outline",disabled:Ne.value.length===0,onClick:Wn},{default:s(()=>[...t[27]||(t[27]=[r(" Select mismatch ",-1)])]),_:1},8,["disabled"]),a(l(g),{size:"sm",variant:"destructive",disabled:Ne.value.length===0,onClick:t[0]||(t[0]=n=>Bt("mismatch"))},{default:s(()=>[...t[28]||(t[28]=[r(" Delete mismatch ",-1)])]),_:1},8,["disabled"]),a(l(g),{size:"sm",variant:"outline",disabled:Pe.value.length===0,onClick:Yn},{default:s(()=>[...t[29]||(t[29]=[r(" Select unlinked ",-1)])]),_:1},8,["disabled"]),a(l(g),{size:"sm",variant:"destructive",disabled:Pe.value.length===0,onClick:t[1]||(t[1]=n=>Bt("unlinked"))},{default:s(()=>[...t[30]||(t[30]=[r(" Delete unlinked ",-1)])]),_:1},8,["disabled"])])])]),i("div",Nl,[i("div",Pl,[i("div",Vl,[i("div",Rl,[a(l(G),{variant:"default"},{default:s(()=>[r("Linked "+d(R.value.paired),1)]),_:1}),a(l(G),{variant:"secondary"},{default:s(()=>[r("Outbound / Inbound "+d(R.value.outbound+R.value.inbound),1)]),_:1}),a(l(G),{variant:"destructive"},{default:s(()=>[r("Mismatch "+d(R.value.mismatch),1)]),_:1}),a(l(G),{variant:"outline"},{default:s(()=>[r("No link "+d(R.value.none),1)]),_:1})]),i("div",Fl,[a(l(g),{size:"sm",variant:z.value?"default":"outline",onClick:Ft},{default:s(()=>[r(d(z.value?"Draw mode on":"Draw mode off"),1)]),_:1},8,["variant"]),t[32]||(t[32]=i("p",{class:"text-muted-foreground"}," Shortcut: ← / → page, D draw mode, E area edit, F locate ",-1))])]),A.value!==null?(f(),_("div",Al,[i("div",Ol,[i("p",null,[r(" Area edit mode: drag the box to move hotspot #"+d(A.value.id)+" or drag handles to scale in/out. Press ",1),t[33]||(t[33]=i("span",{class:"font-semibold"},"Esc",-1)),t[34]||(t[34]=r(" to cancel. ",-1))])]),a(l(g),{size:"sm",variant:"outline",onClick:nt},{default:s(()=>[...t[35]||(t[35]=[r(" Cancel ",-1)])]),_:1})])):C("",!0),i("div",{ref_key:"canvasViewportRef",ref:ut,class:"overflow-auto rounded-xl border bg-background p-3 shadow-sm"},[i("div",Ul,[i("img",{ref_key:"imageRef",ref:We,src:ze.value,alt:`Page ${x.value?.page_no}`,class:"block h-auto w-full rounded-md",draggable:"false",onLoad:ce},null,40,Bl),k.value.width>0&&k.value.height>0?(f(),_("div",{key:0,class:"pointer-events-none absolute top-0 left-0 overflow-visible",style:ae(vt.value)},[(f(!0),_(le,null,_e(w.value,n=>(f(),_("div",{key:n.id,class:N(["pointer-events-auto absolute rounded-sm border-2 transition-colors",[Mn(n),S.value===n.id?"z-20 ring-2 ring-primary ring-offset-1 ring-offset-background":"z-10"]]),style:ae(Ze(n)),title:Ln(n),onMouseenter:o=>S.value=n.id,onMouseleave:o=>lt(n.id),onMousedown:y(o=>kn(n,o),["stop","prevent"]),onTouchstart:y(o=>Dn(n,o),["stop","prevent"])},[F(n)!=="none"?(f(),_("span",Wl,d(zn(F(n))),1)):C("",!0),i("div",{class:N(["absolute z-30 flex items-center gap-0.5 rounded-md border bg-popover/95 p-0.5 shadow-md backdrop-blur-sm",[Tn(n)?"top-0.5 right-0.5":"-top-1 right-0 -translate-y-full"]]),onMousedown:t[2]||(t[2]=y(()=>{},["stop"])),onTouchstart:t[3]||(t[3]=y(()=>{},["stop"])),onClick:t[4]||(t[4]=y(()=>{},["stop"]))},[a(l(g),{size:"icon-sm",variant:"ghost",class:"size-6",title:"Edit",onClick:o=>Z(n)},{default:s(()=>[a(l(al),{class:"size-3"})]),_:1},8,["onClick"]),a(l(g),{size:"icon-sm",variant:"ghost",class:"size-6",title:"Open linked hotspot",disabled:ye(n)===null,onClick:o=>Lt(n)},{default:s(()=>[a(l(gl),{class:"size-3"})]),_:1},8,["disabled","onClick"]),a(l(g),{size:"icon-sm",variant:"ghost",class:"size-6 text-destructive hover:bg-destructive/10 hover:text-destructive",title:"Delete",onClick:o=>It(n)},{default:s(()=>[a(l(ol),{class:"size-3"})]),_:1},8,["onClick"]),h.value===n.id&&b.value!==null?(f(),J(l(g),{key:0,size:"icon-sm",variant:"default",class:"size-6",title:"Save area",disabled:xe.value===n.id,onClick:o=>Rn(n)},{default:s(()=>[a(l(ml),{class:"size-3"})]),_:1},8,["disabled","onClick"])):C("",!0)],34)],46,jl))),128)),A.value!==null&&Je.value!==null?(f(),_("div",{key:0,class:N(["pointer-events-auto absolute rounded-sm border-2 border-dashed border-blue-700/85 bg-blue-600/10",H.value!==null?"cursor-grabbing":"cursor-move"]),style:ae(Ze(Je.value)),onMousedown:t[5]||(t[5]=y(n=>kt("move",n),["stop","prevent"])),onTouchstart:t[6]||(t[6]=y(n=>Dt("move",n),["stop","prevent"]))},[(f(),_(le,null,_e(nn,n=>i("button",{key:`resize-handle-${n}`,type:"button",class:N(["absolute z-10 h-3 w-3 rounded-full border border-white bg-blue-700 shadow-sm",wn(n)]),style:ae(yn(n)),onMousedown:y(o=>kt(n,o),["stop","prevent"]),onTouchstart:y(o=>Dt(n,o),["stop","prevent"])},null,46,Yl)),64))],38)):C("",!0),on.value&&D.value!==null&&A.value===null?(f(),_("div",{key:1,class:"absolute rounded-sm border-2 border-blue-500 bg-blue-500/15",style:ae(Ze(D.value))},null,4)):C("",!0)],4)):C("",!0),z.value&&A.value===null&&k.value.width>0&&k.value.height>0?(f(),_("div",{key:1,class:"absolute top-0 left-0 cursor-crosshair touch-none",style:ae(vt.value),onMousedown:mn,onMousemove:_n,onMouseup:hn,onTouchstart:y(bn,["prevent"]),onTouchmove:y(xn,["prevent"]),onTouchend:y(yt,["prevent"]),onTouchcancel:y(yt,["prevent"])},null,36)):C("",!0),!z.value&&k.value.width>0&&k.value.height>0?(f(),_("div",Xl," Draw mode off ")):C("",!0)])],512)]),i("div",ql,[i("div",Kl,[i("div",null,[t[36]||(t[36]=i("h2",{class:"text-sm font-semibold"}," Existing hotspots ",-1)),i("p",Jl,d(Y.value.length)+" of "+d(w.value.length)+" shown ",1)]),a(l(G),{variant:"outline"},{default:s(()=>[r(d(w.value.length),1)]),_:1})]),i("div",Gl,[a(l(Gt),{modelValue:te.value,"onUpdate:modelValue":t[7]||(t[7]=n=>te.value=n),type:"text",placeholder:"Search by id, relation, page, label, or link"},null,8,["modelValue"]),i("div",Ql,[t[41]||(t[41]=i("p",{class:"text-xs font-medium tracking-wide text-muted-foreground uppercase"}," Sort ",-1)),a(l(Ce),{modelValue:ne.value,"onUpdate:modelValue":t[8]||(t[8]=n=>ne.value=n)},{default:s(()=>[a(l(Se),null,{default:s(()=>[a(l($e),{placeholder:"Sort hotspots"})]),_:1}),a(l(He),null,{default:s(()=>[a(l(B),{value:"id_asc"},{default:s(()=>[...t[37]||(t[37]=[r("ID (oldest first)",-1)])]),_:1}),a(l(B),{value:"id_desc"},{default:s(()=>[...t[38]||(t[38]=[r("ID (newest first)",-1)])]),_:1}),a(l(B),{value:"target_page"},{default:s(()=>[...t[39]||(t[39]=[r("Target page",-1)])]),_:1}),a(l(B),{value:"relation"},{default:s(()=>[...t[40]||(t[40]=[r("Relation kind",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",Zl,[a(l(g),{size:"sm",variant:"outline",class:N(P.value==="all"?"border-primary bg-primary/10 text-primary":""),onClick:t[9]||(t[9]=n=>fe("all"))},{default:s(()=>[r(" All "+d(pe("all")),1)]),_:1},8,["class"]),a(l(g),{size:"sm",variant:"outline",class:N(P.value==="paired"?"border-primary bg-primary/10 text-primary":""),onClick:t[10]||(t[10]=n=>fe("paired"))},{default:s(()=>[r(" Linked "+d(pe("paired")),1)]),_:1},8,["class"]),a(l(g),{size:"sm",variant:"outline",class:N(P.value==="outbound"?"border-primary bg-primary/10 text-primary":""),onClick:t[11]||(t[11]=n=>fe("outbound"))},{default:s(()=>[r(" Out "+d(pe("outbound")),1)]),_:1},8,["class"]),a(l(g),{size:"sm",variant:"outline",class:N(P.value==="inbound"?"border-primary bg-primary/10 text-primary":""),onClick:t[12]||(t[12]=n=>fe("inbound"))},{default:s(()=>[r(" In "+d(pe("inbound")),1)]),_:1},8,["class"]),a(l(g),{size:"sm",variant:"outline",class:N(P.value==="mismatch"?"border-primary bg-primary/10 text-primary":""),onClick:t[13]||(t[13]=n=>fe("mismatch"))},{default:s(()=>[r(" Mismatch "+d(pe("mismatch")),1)]),_:1},8,["class"]),a(l(g),{size:"sm",variant:"outline",class:N(P.value==="none"?"border-primary bg-primary/10 text-primary":""),onClick:t[14]||(t[14]=n=>fe("none"))},{default:s(()=>[r(" No link "+d(pe("none")),1)]),_:1},8,["class"])]),i("div",ea,[te.value.trim()!==""?(f(),J(l(g),{key:0,size:"sm",variant:"ghost",class:"w-fit",onClick:t[15]||(t[15]=n=>te.value="")},{default:s(()=>[...t[42]||(t[42]=[r(" Clear search ",-1)])]),_:1})):C("",!0),gn.value?(f(),J(l(g),{key:1,size:"sm",variant:"outline",class:"w-fit",onClick:Bn},{default:s(()=>[...t[43]||(t[43]=[r(" Reset filters ",-1)])]),_:1})):C("",!0)]),i("div",ta,[i("div",na,[i("p",null," Selected "+d(we.value)+" hotspot(s) ",1),i("p",null," Visible selected "+d(gt.value)+"/"+d(Y.value.length),1)]),i("div",la,[a(l(g),{size:"sm",variant:"outline",disabled:Y.value.length===0,onClick:Xn},{default:s(()=>[r(d(mt.value?"Unselect shown":"Select shown"),1)]),_:1},8,["disabled"]),a(l(g),{size:"sm",variant:"ghost",disabled:!Ie.value,onClick:Ut},{default:s(()=>[...t[44]||(t[44]=[r(" Clear selected ",-1)])]),_:1},8,["disabled"]),a(l(g),{size:"sm",variant:"destructive",disabled:!Ie.value||l(de).processing,onClick:jt},{default:s(()=>[...t[45]||(t[45]=[r(" Delete selected ",-1)])]),_:1},8,["disabled","onClick"])])])]),i("div",aa,[(f(!0),_(le,null,_e(Y.value,n=>(f(),_("div",{key:n.id,ref_for:!0,ref:o=>Un(n.id,o),role:"button",tabindex:"0",class:N(["group cursor-pointer space-y-3 rounded-lg border bg-card p-3 shadow-sm transition hover:border-primary/40",[S.value===n.id?"border-primary bg-primary/5":"",Le.value.has(n.id)?"border-destructive/40 bg-destructive/5":""]]),onMouseenter:o=>Ot(n.id),onMouseleave:o=>lt(n.id),onFocus:o=>Ot(n.id),onBlur:o=>lt(n.id),onClick:o=>Z(n),onKeydown:[qt(y(o=>Z(n),["prevent"]),["enter"]),qt(y(o=>Z(n),["prevent"]),["space"])]},[i("div",ia,[i("label",{class:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",onClick:t[16]||(t[16]=y(()=>{},["stop"]))},[i("input",{type:"checkbox",class:"h-4 w-4 rounded border-border text-primary focus:ring-primary",checked:Le.value.has(n.id),onChange:y(o=>jn(n.id),["stop"])},null,40,sa),i("span",ua,"Select hotspot "+d(n.id),1)]),i("div",ra,[ze.value!==""?(f(),_("img",{key:0,src:ze.value,alt:"",class:"pointer-events-none absolute select-none",draggable:"false",style:ae(Cn(n))},null,12,da)):(f(),_("div",ca," No preview "))]),i("div",va,[i("div",fa,[i("p",pa," #"+d(n.id),1),a(l(G),{variant:Hn(F(n))},{default:s(()=>[r(d(Oe(F(n))),1)]),_:2},1032,["variant"])]),i("p",ga,d(n.relation_kind)+" → page "+d(n.target_page_no),1),n.target_hotspot_id||n.linked_hotspot_id?(f(),_("p",ma,[r(" Linked hotspot: #"+d(n.target_hotspot_id??n.linked_hotspot_id)+" ",1),St(n)!==null?(f(),_("span",_a," (Page "+d(St(n))+") ",1)):C("",!0)])):C("",!0),n.label?(f(),_("p",ha,d(n.label),1)):C("",!0)])]),i("div",{class:N(["flex max-h-0 flex-wrap gap-2 overflow-hidden opacity-0 transition-all duration-200 group-focus-within:max-h-20 group-focus-within:opacity-100 group-hover:max-h-20 group-hover:opacity-100",[S.value===n.id||Le.value.has(n.id)?"!max-h-20 !opacity-100":""]])},[a(l(g),{size:"sm",variant:"outline",class:"flex-1 sm:flex-none",onClick:y(o=>At(n),["stop"])},{default:s(()=>[...t[46]||(t[46]=[r(" Locate ",-1)])]),_:1},8,["onClick"]),a(l(g),{size:"sm",variant:"outline",class:"flex-1 sm:flex-none",onClick:y(o=>Z(n),["stop"])},{default:s(()=>[...t[47]||(t[47]=[r(" Edit ",-1)])]),_:1},8,["onClick"]),a(l(g),{size:"sm",variant:h.value===n.id?"default":"outline",class:"flex-1 sm:flex-none",onClick:y(o=>h.value===n.id?nt():ke(n),["stop"])},{default:s(()=>[r(d(h.value===n.id?"Cancel area edit":"Drag area"),1)]),_:2},1032,["variant","onClick"]),a(l(g),{size:"sm",variant:"secondary",class:"flex-1 sm:flex-none",disabled:ye(n)===null,onClick:y(o=>Lt(n),["stop"])},{default:s(()=>[...t[48]||(t[48]=[r(" Open linked ",-1)])]),_:1},8,["disabled","onClick"]),a(l(g),{size:"sm",variant:"destructive",class:"flex-1 sm:flex-none",onClick:y(o=>It(n),["stop"])},{default:s(()=>[...t[49]||(t[49]=[r(" Delete ",-1)])]),_:1},8,["onClick"])],2)],42,oa))),128)),Y.value.length===0&&w.value.length>0?(f(),_("p",ba," No hotspots match your search. ")):C("",!0),w.value.length===0?(f(),_("p",xa," No hotspots yet. Draw a rectangle on the page image to create one. ")):C("",!0)])])])]),_:1})]),_:1})):(f(),J(l(Kt),{key:1},{default:s(()=>[a(l(Jt),{class:"py-6 text-sm text-muted-foreground"},{default:s(()=>[...t[50]||(t[50]=[r(" No pages found yet. Upload pages first, then open mapping. ",-1)])]),_:1})]),_:1})),a(l(ul),{open:Q.value,"onUpdate:open":Pn},{default:s(()=>[a(l(rl),{class:"sm:max-w-2xl"},{default:s(()=>[a(l(dl),null,{default:s(()=>[a(l(cl),null,{default:s(()=>[r(d(ln.value),1)]),_:1}),a(l(vl),null,{default:s(()=>[...t[51]||(t[51]=[r(" Configure relation, target page, and optionally a specific target hotspot. ",-1)])]),_:1})]),_:1}),Ee.value?(f(),_("p",wa," You have unsaved changes in this hotspot form. ")):C("",!0),i("div",ya,[i("div",ka,[t[58]||(t[58]=i("p",{class:"text-xs font-medium tracking-wide text-muted-foreground uppercase"}," Link settings ",-1)),i("div",Da,[i("div",Ca,[t[54]||(t[54]=i("label",{class:"text-sm font-medium"},"Relation kind",-1)),a(l(Ce),{modelValue:l(u).relation_kind,"onUpdate:modelValue":t[17]||(t[17]=n=>l(u).relation_kind=n)},{default:s(()=>[a(l(Se),null,{default:s(()=>[a(l($e),{placeholder:"Select relation"})]),_:1}),a(l(He),null,{default:s(()=>[a(l(B),{value:"next"},{default:s(()=>[...t[52]||(t[52]=[r("next",-1)])]),_:1}),a(l(B),{value:"previous"},{default:s(()=>[...t[53]||(t[53]=[r("previous",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(je,{message:l(u).errors.relation_kind},null,8,["message"])]),i("div",Sa,[t[55]||(t[55]=i("label",{class:"text-sm font-medium"},"Target page",-1)),a(l(Ce),{modelValue:l(u).target_page_no,"onUpdate:modelValue":t[18]||(t[18]=n=>l(u).target_page_no=n)},{default:s(()=>[a(l(Se),null,{default:s(()=>[a(l($e),{placeholder:"Select target page"})]),_:1}),a(l(He),null,{default:s(()=>[(f(!0),_(le,null,_e(rt.value,n=>(f(),J(l(B),{key:n,value:n},{default:s(()=>[r(" Page "+d(n),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),a(je,{message:l(u).errors.target_page_no},null,8,["message"])])]),i("div",$a,[t[57]||(t[57]=i("label",{class:"text-sm font-medium"},"Target hotspot (optional)",-1)),a(l(Ce),{modelValue:ct.value,"onUpdate:modelValue":t[19]||(t[19]=n=>ct.value=n)},{default:s(()=>[a(l(Se),null,{default:s(()=>[a(l($e),{placeholder:"Any hotspot on target page"})]),_:1}),a(l(He),null,{default:s(()=>[a(l(B),{value:"__none"},{default:s(()=>[...t[56]||(t[56]=[r("Any hotspot on target page",-1)])]),_:1}),(f(!0),_(le,null,_e(dt.value,n=>(f(),J(l(B),{key:n.id,value:String(n.id)},{default:s(()=>[r(" #"+d(n.id)+" ",1),n.label?(f(),_("span",Ha," - "+d(n.label),1)):C("",!0),i("span",Ma," ("+d(n.relation_kind)+" → "+d(n.target_page_no)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),a(je,{message:l(u).errors.target_hotspot_id},null,8,["message"])])]),i("div",Ta,[i("div",za,[t[59]||(t[59]=i("label",{class:"text-sm font-medium"},"Label (optional)",-1)),a(l(Gt),{modelValue:l(u).label,"onUpdate:modelValue":t[20]||(t[20]=n=>l(u).label=n),placeholder:"Optional label"},null,8,["modelValue"]),a(je,{message:l(u).errors.label},null,8,["message"])]),$.value!==null?(f(),_("div",La,[t[61]||(t[61]=i("p",{class:"text-xs text-muted-foreground"}," Need a new area? Drag-select directly on the page image. ",-1)),a(l(g),{size:"sm",variant:"outline",onClick:On},{default:s(()=>[...t[60]||(t[60]=[r(" Edit area by drag ",-1)])]),_:1})])):C("",!0)])]),a(l(fl),null,{default:s(()=>[a(l(g),{variant:"outline",disabled:l(u).processing,onClick:zt},{default:s(()=>[...t[62]||(t[62]=[r(" Cancel ",-1)])]),_:1},8,["disabled"]),a(l(g),{disabled:l(u).processing,onClick:Vn},{default:s(()=>[r(d(an.value),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),a(st,{open:ie.value,title:"Delete hotspot?",description:V.value===null?"This action cannot be undone.":`Delete hotspot #${V.value.id}? This action cannot be undone.`,"confirm-text":"Delete","confirm-variant":"destructive","onUpdate:open":An,onConfirm:Fn},null,8,["open","description"]),a(st,{open:se.value,title:un.value,description:dn.value,"confirm-text":rn.value,"confirm-variant":"destructive",processing:l(de).processing,"onUpdate:open":Kn,onConfirm:qn},null,8,["open","title","description","confirm-text","processing"]),a(st,{open:ue.value,title:"Discard unsaved changes?",description:"Your hotspot form has unsaved changes. Discard them and close?","confirm-text":"Discard changes","confirm-variant":"destructive","onUpdate:open":Nn,onConfirm:En},null,8,["open"])])]),_:1})],64))}});export{oo as default};
